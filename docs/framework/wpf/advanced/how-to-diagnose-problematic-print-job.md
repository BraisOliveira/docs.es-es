---
title: Procedimiento Diagnosticar trabajos de impresión problemáticos
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
- cpp
helpviewer_keywords:
- troubleshooting print job problems [WPF]
- print jobs [WPF], troubleshooting
- print jobs [WPF], diagnosing problems
ms.assetid: b081a170-84c6-48f9-a487-5766a8d58a82
ms.openlocfilehash: d64e77b7fc6862eead3cb7e791b3a8f68ac52713
ms.sourcegitcommit: 83ecdf731dc1920bca31f017b1556c917aafd7a0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 07/12/2019
ms.locfileid: "67859734"
---
# <a name="how-to-diagnose-problematic-print-job"></a><span data-ttu-id="0d61a-102">Procedimiento Diagnosticar trabajos de impresión problemáticos</span><span class="sxs-lookup"><span data-stu-id="0d61a-102">How to: Diagnose Problematic Print Job</span></span>
<span data-ttu-id="0d61a-103">A menudo, los administradores de red reciben quejas de los usuarios sobre trabajos de impresión que no se imprimen o que se imprimen lentamente.</span><span class="sxs-lookup"><span data-stu-id="0d61a-103">Network administrators often field complaints from users about print jobs that do not print or print slowly.</span></span> <span data-ttu-id="0d61a-104">El amplio conjunto de propiedades del trabajo de impresión expuesto en la API de Microsoft .NET Framework proporciona un medio para realizar un diagnóstico remoto rápido de trabajos de impresión.</span><span class="sxs-lookup"><span data-stu-id="0d61a-104">The rich set of print job properties exposed in the APIs of Microsoft .NET Framework provide a means for performing a rapid remote diagnosis of print jobs.</span></span>  
  
## <a name="example"></a><span data-ttu-id="0d61a-105">Ejemplo</span><span class="sxs-lookup"><span data-stu-id="0d61a-105">Example</span></span>  
 <span data-ttu-id="0d61a-106">Los pasos principales para crear este tipo de utilidad son los siguientes.</span><span class="sxs-lookup"><span data-stu-id="0d61a-106">The major steps for creating this kind of utility are as follows.</span></span>  
  
1. <span data-ttu-id="0d61a-107">Identificar el trabajo de impresión sobre el que se queja el usuario.</span><span class="sxs-lookup"><span data-stu-id="0d61a-107">Identify the print job that the user is complaining about.</span></span> <span data-ttu-id="0d61a-108">Los usuarios a menudo no pueden hacer esto con precisión.</span><span class="sxs-lookup"><span data-stu-id="0d61a-108">Users often cannot do this precisely.</span></span> <span data-ttu-id="0d61a-109">Puede que no conozcan los nombres de los servidores de impresión o de las impresoras.</span><span class="sxs-lookup"><span data-stu-id="0d61a-109">They may not know the names of the print servers or printers.</span></span> <span data-ttu-id="0d61a-110">Es posible que describen la ubicación de la impresora con una terminología distinta a la utilizada en la configuración de su <xref:System.Printing.PrintQueue.Location%2A> propiedad.</span><span class="sxs-lookup"><span data-stu-id="0d61a-110">They may describe the location of the printer in different terminology than was used in setting its <xref:System.Printing.PrintQueue.Location%2A> property.</span></span> <span data-ttu-id="0d61a-111">Por lo tanto, es conveniente generar una lista de los trabajos enviados actualmente por el usuario.</span><span class="sxs-lookup"><span data-stu-id="0d61a-111">Accordingly, it is a good idea to generate a list of the user's currently submitted jobs.</span></span> <span data-ttu-id="0d61a-112">Si hay más de uno, la comunicación entre el usuario y el administrador del sistema de impresión puede utilizarse para identificar el trabajo que está experimentando problemas.</span><span class="sxs-lookup"><span data-stu-id="0d61a-112">If there is more than one, then communication between the user and the print system administrator can be used to pinpoint the job that is having problems.</span></span> <span data-ttu-id="0d61a-113">Los pasos secundarios son los siguientes.</span><span class="sxs-lookup"><span data-stu-id="0d61a-113">The substeps are as follows.</span></span>  
  
    1. <span data-ttu-id="0d61a-114">Obtener una lista de todos los servidores de impresión.</span><span class="sxs-lookup"><span data-stu-id="0d61a-114">Obtain a list of all print servers.</span></span>  
  
    2. <span data-ttu-id="0d61a-115">Recorrer los servidores para consultar sus colas de impresión.</span><span class="sxs-lookup"><span data-stu-id="0d61a-115">Loop through the servers to query their print queues.</span></span>  
  
    3. <span data-ttu-id="0d61a-116">En cada superación del bucle de servidor, recorrer todas las colas del servidor para consultar los trabajos.</span><span class="sxs-lookup"><span data-stu-id="0d61a-116">Within each pass of the server loop, loop through all the server's queues to query their jobs</span></span>  
  
    4. <span data-ttu-id="0d61a-117">En cada superación del bucle de cola, recorrer todos los trabajos y recopilar la información de identificación sobre lo enviado por el usuario que se queja.</span><span class="sxs-lookup"><span data-stu-id="0d61a-117">Within each pass of the queue loop, loop through its jobs and gather identifying information about those that were submitted by the complaining user.</span></span>  
  
2. <span data-ttu-id="0d61a-118">Cuando se haya identificado el trabajo de impresión problemático, examine las propiedades pertinentes para ver cuál puede ser el problema.</span><span class="sxs-lookup"><span data-stu-id="0d61a-118">When the problematic print job has been identified, examine relevant properties to see what might be the problem.</span></span> <span data-ttu-id="0d61a-119">Por ejemplo, ¿el trabajo está en estado de error o la impresora mantuvo la cola sin conexión antes de que se pudiera imprimir el trabajo?</span><span class="sxs-lookup"><span data-stu-id="0d61a-119">For example, is job in an error state or did the printer servicing the queue go offline before the job could print?</span></span>  
  
 <span data-ttu-id="0d61a-120">El código siguiente es una serie de ejemplos de código.</span><span class="sxs-lookup"><span data-stu-id="0d61a-120">The code below is series of code examples.</span></span> <span data-ttu-id="0d61a-121">El primer ejemplo de código contiene el recorrido por las colas de impresión.</span><span class="sxs-lookup"><span data-stu-id="0d61a-121">The first code example contains the loop through the print queues.</span></span> <span data-ttu-id="0d61a-122">(Paso 1c anterior). La variable `myPrintQueues` es la <xref:System.Printing.PrintQueueCollection> objeto para el servidor de impresión actual.</span><span class="sxs-lookup"><span data-stu-id="0d61a-122">(Step 1c above.) The variable `myPrintQueues` is the <xref:System.Printing.PrintQueueCollection> object for the current print server.</span></span>  
  
 <span data-ttu-id="0d61a-123">El ejemplo de código comienza por la actualización del objeto de cola de impresión actual con <xref:System.Printing.PrintQueue.Refresh%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="0d61a-123">The code example begins by refreshing the current print queue object with <xref:System.Printing.PrintQueue.Refresh%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="0d61a-124">Esto garantiza que las propiedades del objeto representan con precisión el estado de la impresora física a la que hace referencia.</span><span class="sxs-lookup"><span data-stu-id="0d61a-124">This ensures that the object's properties accurately represent the state of the physical printer that it represents.</span></span> <span data-ttu-id="0d61a-125">A continuación, la aplicación obtiene la colección de trabajos de impresión actualmente en la cola de impresión mediante el uso de <xref:System.Printing.PrintQueue.GetPrintJobInfoCollection%2A>.</span><span class="sxs-lookup"><span data-stu-id="0d61a-125">Then the application gets the collection of print jobs currently in the print queue by using <xref:System.Printing.PrintQueue.GetPrintJobInfoCollection%2A>.</span></span>  
  
 <span data-ttu-id="0d61a-126">A continuación la aplicación recorre la <xref:System.Printing.PrintSystemJobInfo> cada colección y lo compara <xref:System.Printing.PrintSystemJobInfo.Submitter%2A> propiedad con el alias del usuario que se queja.</span><span class="sxs-lookup"><span data-stu-id="0d61a-126">Next the application loops through the <xref:System.Printing.PrintSystemJobInfo> collection and compares each <xref:System.Printing.PrintSystemJobInfo.Submitter%2A> property with the alias of the complaining user.</span></span> <span data-ttu-id="0d61a-127">Si coinciden, la aplicación agrega información de identificación sobre el trabajo a la cadena que se mostrará.</span><span class="sxs-lookup"><span data-stu-id="0d61a-127">If they match, the application adds identifying information about the job to the string that will be presented.</span></span> <span data-ttu-id="0d61a-128">(Las variables `userName` y `jobList` se inicializan anteriormente en la aplicación).</span><span class="sxs-lookup"><span data-stu-id="0d61a-128">(The `userName` and `jobList` variables are initialized earlier in the application.)</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#EnumerateJobsInQueues](~/samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#enumeratejobsinqueues)]
 [!code-csharp[DiagnoseProblematicPrintJob#EnumerateJobsInQueues](~/samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#enumeratejobsinqueues)]
 [!code-vb[DiagnoseProblematicPrintJob#EnumerateJobsInQueues](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#enumeratejobsinqueues)]  
  
 <span data-ttu-id="0d61a-129">En el ejemplo de código siguiente se toma la aplicación en el paso 2.</span><span class="sxs-lookup"><span data-stu-id="0d61a-129">The next code example picks up the application at Step 2.</span></span> <span data-ttu-id="0d61a-130">(Vea más arriba). Se ha identificado el trabajo problemático y la aplicación solicita la información que lo identificará.</span><span class="sxs-lookup"><span data-stu-id="0d61a-130">(See above.) The problematic job has been identified and the application prompts for the information that will identify it.</span></span> <span data-ttu-id="0d61a-131">De esta información crea <xref:System.Printing.PrintServer>, <xref:System.Printing.PrintQueue>, y <xref:System.Printing.PrintSystemJobInfo> objetos.</span><span class="sxs-lookup"><span data-stu-id="0d61a-131">From this information it creates <xref:System.Printing.PrintServer>, <xref:System.Printing.PrintQueue>, and <xref:System.Printing.PrintSystemJobInfo> objects.</span></span>  
  
 <span data-ttu-id="0d61a-132">En este punto, la aplicación contiene una estructura de bifurcación correspondiente a las dos maneras de comprobar el estado de un trabajo de impresión:</span><span class="sxs-lookup"><span data-stu-id="0d61a-132">At this point the application contains a branching structure corresponding to the two ways of checking a print job's status:</span></span>  
  
- <span data-ttu-id="0d61a-133">Puede leer los marcadores de la <xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> propiedad que es de tipo <xref:System.Printing.PrintJobStatus>.</span><span class="sxs-lookup"><span data-stu-id="0d61a-133">You can read the flags of the <xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> property which is of type <xref:System.Printing.PrintJobStatus>.</span></span>  
  
- <span data-ttu-id="0d61a-134">Puede leer cada propiedad pertinente, como <xref:System.Printing.PrintSystemJobInfo.IsBlocked%2A> y <xref:System.Printing.PrintSystemJobInfo.IsInError%2A>.</span><span class="sxs-lookup"><span data-stu-id="0d61a-134">You can read each relevant property such as <xref:System.Printing.PrintSystemJobInfo.IsBlocked%2A> and <xref:System.Printing.PrintSystemJobInfo.IsInError%2A>.</span></span>  
  
 <span data-ttu-id="0d61a-135">En este ejemplo se muestra ambos métodos, por lo que el usuario se le pregunte qué método utilizar y Respondí con "S" si quería utilizar los marcadores de anteriormente el <xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> propiedad.</span><span class="sxs-lookup"><span data-stu-id="0d61a-135">This example demonstrates both methods, so the user was previously prompted as to which method to use and responded with "Y" if he or she wanted to use the flags of the <xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> property.</span></span> <span data-ttu-id="0d61a-136">A continuación encontrará los detalles de los dos métodos.</span><span class="sxs-lookup"><span data-stu-id="0d61a-136">See below for the details of the two methods.</span></span> <span data-ttu-id="0d61a-137">Por último, la aplicación utiliza un método denominado **ReportQueueAndJobAvailability** para informar de si el trabajo se puede imprimir a esta hora del día.</span><span class="sxs-lookup"><span data-stu-id="0d61a-137">Finally, the application uses a method called **ReportQueueAndJobAvailability** to report on whether the job can be printed at this time of day.</span></span> <span data-ttu-id="0d61a-138">Este método se trata en [Detectar si un trabajo de impresión se puede imprimir en esta hora del día](how-to-discover-whether-a-print-job-can-be-printed-at-this-time-of-day.md).</span><span class="sxs-lookup"><span data-stu-id="0d61a-138">This method is discussed in [Discover Whether a Print Job Can Be Printed At This Time of Day](how-to-discover-whether-a-print-job-can-be-printed-at-this-time-of-day.md).</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#IdentifyAndDiagnoseProblematicJob](~/samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#identifyanddiagnoseproblematicjob)]
 [!code-csharp[DiagnoseProblematicPrintJob#IdentifyAndDiagnoseProblematicJob](~/samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#identifyanddiagnoseproblematicjob)]
 [!code-vb[DiagnoseProblematicPrintJob#IdentifyAndDiagnoseProblematicJob](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#identifyanddiagnoseproblematicjob)]  
  
 <span data-ttu-id="0d61a-139">Para comprobar el estado del trabajo de impresión mediante los marcadores de la <xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> propiedad, se comprueba cada marcador pertinente para ver si está establecido.</span><span class="sxs-lookup"><span data-stu-id="0d61a-139">To check print job status using the flags of the <xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> property, you check each relevant flag to see if it is set.</span></span> <span data-ttu-id="0d61a-140">El modo estándar para ver si un bit se establece en un conjunto de marcadores de bits es realizar una operación AND lógica con el conjunto de marcadores como uno de los operandos y la propia marca como el otro.</span><span class="sxs-lookup"><span data-stu-id="0d61a-140">The standard way to see if one bit is set in a set of bit flags is to perform a logical AND operation with the set of flags as one operand and the flag itself as the other.</span></span> <span data-ttu-id="0d61a-141">Puesto que el propio marcador solo tiene un bit establecido, el resultado del operador lógico AND es que, como máximo, se establezca ese mismo bit.</span><span class="sxs-lookup"><span data-stu-id="0d61a-141">Since the flag itself has only one bit set, the result of the logical AND is that, at most, that same bit is set.</span></span> <span data-ttu-id="0d61a-142">Para averiguar si esto ocurre o no, basta con comparar el resultado del operador lógico AND y el propio marcador.</span><span class="sxs-lookup"><span data-stu-id="0d61a-142">To find out whether it is or not, just compare the result of the logical AND with the flag itself.</span></span> <span data-ttu-id="0d61a-143">Para obtener más información, consulte <xref:System.Printing.PrintJobStatus>, [& (operador) (C# referencia)](~/docs/csharp/language-reference/operators/bitwise-and-shift-operators.md#logical-and-operator-), y <xref:System.FlagsAttribute>.</span><span class="sxs-lookup"><span data-stu-id="0d61a-143">For more information, see <xref:System.Printing.PrintJobStatus>, the [& Operator (C# Reference)](~/docs/csharp/language-reference/operators/bitwise-and-shift-operators.md#logical-and-operator-), and <xref:System.FlagsAttribute>.</span></span>  
  
 <span data-ttu-id="0d61a-144">El código informa de cada atributo cuyo bit esté establecido en la pantalla de la consola y a veces sugiere una manera de responder.</span><span class="sxs-lookup"><span data-stu-id="0d61a-144">For each attribute whose bit is set, the code reports this to the console screen and sometimes suggests a way to respond.</span></span> <span data-ttu-id="0d61a-145">(A continuación se describe el método **HandlePausedJob** que se llama si el trabajo o la cola está en pausa).</span><span class="sxs-lookup"><span data-stu-id="0d61a-145">(The **HandlePausedJob** method that is called if the job or queue is paused is discussed below.)</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#SpotTroubleUsingJobAttributes](~/samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#spottroubleusingjobattributes)]
 [!code-csharp[DiagnoseProblematicPrintJob#SpotTroubleUsingJobAttributes](~/samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#spottroubleusingjobattributes)]
 [!code-vb[DiagnoseProblematicPrintJob#SpotTroubleUsingJobAttributes](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#spottroubleusingjobattributes)]  
  
 <span data-ttu-id="0d61a-146">Para comprobar el estado del trabajo de impresión mediante propiedades independientes, basta con leer cada propiedad y, si la propiedad es `true`, informar a la pantalla de la consola y sugerir posiblemente una forma de responder.</span><span class="sxs-lookup"><span data-stu-id="0d61a-146">To check print job status using separate properties, you simply read each property and, if the property is `true`, report to the console screen and possibly suggest a way to respond.</span></span> <span data-ttu-id="0d61a-147">(A continuación se describe el método **HandlePausedJob** que se llama si el trabajo o la cola está en pausa).</span><span class="sxs-lookup"><span data-stu-id="0d61a-147">(The **HandlePausedJob** method that is called if the job or queue is paused is discussed below.)</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#SpotTroubleUsingJobProperties](~/samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#spottroubleusingjobproperties)]
 [!code-csharp[DiagnoseProblematicPrintJob#SpotTroubleUsingJobProperties](~/samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#spottroubleusingjobproperties)]
 [!code-vb[DiagnoseProblematicPrintJob#SpotTroubleUsingJobProperties](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#spottroubleusingjobproperties)]  
  
 <span data-ttu-id="0d61a-148">El método **HandlePausedJob** permite que los usuarios de la aplicación reanuden remotamente los trabajos en pausa.</span><span class="sxs-lookup"><span data-stu-id="0d61a-148">The **HandlePausedJob** method enables the application's user to remotely resume paused jobs.</span></span> <span data-ttu-id="0d61a-149">Puesto que puede haber una buena razón de por qué se pausó la cola de impresión, el método comienza solicitando al usuario una decisión sobre la reanudación.</span><span class="sxs-lookup"><span data-stu-id="0d61a-149">Because there might be a good reason why the print queue was paused, the method begins by prompting for a user decision about whether to resume it.</span></span> <span data-ttu-id="0d61a-150">Si la respuesta es "S", el <xref:System.Printing.PrintQueue.Resume%2A?displayProperty=nameWithType> se llama al método.</span><span class="sxs-lookup"><span data-stu-id="0d61a-150">If the answer is "Y", then the <xref:System.Printing.PrintQueue.Resume%2A?displayProperty=nameWithType> method is called.</span></span>  
  
 <span data-ttu-id="0d61a-151">A continuación se solicita al usuario que decida si se debe reanudar el propio trabajo, en caso de que se esté en pausa independientemente de la cola de impresión.</span><span class="sxs-lookup"><span data-stu-id="0d61a-151">Next the user is prompted to decide if the job itself should be resumed, just in case it is paused independently of the print queue.</span></span> <span data-ttu-id="0d61a-152">(Compare <xref:System.Printing.PrintQueue.IsPaused%2A?displayProperty=nameWithType> y <xref:System.Printing.PrintSystemJobInfo.IsPaused%2A?displayProperty=nameWithType>.) Si la respuesta es "S", a continuación, <xref:System.Printing.PrintSystemJobInfo.Resume%2A?displayProperty=nameWithType> llamado; de lo contrario <xref:System.Printing.PrintSystemJobInfo.Cancel%2A> se llama.</span><span class="sxs-lookup"><span data-stu-id="0d61a-152">(Compare <xref:System.Printing.PrintQueue.IsPaused%2A?displayProperty=nameWithType> and <xref:System.Printing.PrintSystemJobInfo.IsPaused%2A?displayProperty=nameWithType>.) If the answer is "Y", then <xref:System.Printing.PrintSystemJobInfo.Resume%2A?displayProperty=nameWithType> is called; otherwise <xref:System.Printing.PrintSystemJobInfo.Cancel%2A> is called.</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#HandlePausedJob](~/samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#handlepausedjob)]
 [!code-csharp[DiagnoseProblematicPrintJob#HandlePausedJob](~/samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#handlepausedjob)]
 [!code-vb[DiagnoseProblematicPrintJob#HandlePausedJob](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#handlepausedjob)]  
  
## <a name="see-also"></a><span data-ttu-id="0d61a-153">Vea también</span><span class="sxs-lookup"><span data-stu-id="0d61a-153">See also</span></span>

- <xref:System.Printing.PrintJobStatus>
- <xref:System.Printing.PrintSystemJobInfo>
- <xref:System.FlagsAttribute>
- <xref:System.Printing.PrintQueue>
- [<span data-ttu-id="0d61a-154">& (Operador) (C# referencia)</span><span class="sxs-lookup"><span data-stu-id="0d61a-154">& Operator (C# Reference)</span></span>](~/docs/csharp/language-reference/operators/bitwise-and-shift-operators.md#logical-and-operator-)
- [<span data-ttu-id="0d61a-155">Documentos en WPF</span><span class="sxs-lookup"><span data-stu-id="0d61a-155">Documents in WPF</span></span>](documents-in-wpf.md)
- [<span data-ttu-id="0d61a-156">Información general sobre impresión</span><span class="sxs-lookup"><span data-stu-id="0d61a-156">Printing Overview</span></span>](printing-overview.md)
