---
title: Consideraciones de rendimiento para la interoperabilidad entre Direct3D9 y WPF
ms.date: 03/30/2017
helpviewer_keywords:
- WPF [WPF], Direct3D9 interop performance
- Direct3D9 [WPF interoperability], performance
ms.assetid: ea8baf91-12fe-4b44-ac4d-477110ab14dd
ms.openlocfilehash: 02a91c1824c5d6374f37b0af66a3308d33210c4a
ms.sourcegitcommit: 68653db98c5ea7744fd438710248935f70020dfb
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/22/2019
ms.locfileid: "69932491"
---
# <a name="performance-considerations-for-direct3d9-and-wpf-interoperability"></a><span data-ttu-id="efc23-102">Consideraciones de rendimiento para la interoperabilidad entre Direct3D9 y WPF</span><span class="sxs-lookup"><span data-stu-id="efc23-102">Performance Considerations for Direct3D9 and WPF Interoperability</span></span>
<span data-ttu-id="efc23-103">Puede hospedar contenido de Direct3D9 mediante la <xref:System.Windows.Interop.D3DImage> clase.</span><span class="sxs-lookup"><span data-stu-id="efc23-103">You can host Direct3D9 content by using the <xref:System.Windows.Interop.D3DImage> class.</span></span> <span data-ttu-id="efc23-104">El hospedaje de contenido de Direct3D9 puede afectar al rendimiento de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="efc23-104">Hosting Direct3D9 content can affect the performance of your application.</span></span> <span data-ttu-id="efc23-105">En este tema se describen los procedimientos recomendados para optimizar el rendimiento al hospedar contenido de Direct3D9 en una aplicación Windows Presentation Foundation (WPF).</span><span class="sxs-lookup"><span data-stu-id="efc23-105">This topic describes best practices to optimize performance when hosting Direct3D9 content in a Windows Presentation Foundation (WPF) application.</span></span> <span data-ttu-id="efc23-106">Estos procedimientos recomendados incluyen cómo usar <xref:System.Windows.Interop.D3DImage> y procedimientos recomendados cuando se usa Windows Vista, Windows XP y pantallas de varios monitores.</span><span class="sxs-lookup"><span data-stu-id="efc23-106">These best practices include how to use <xref:System.Windows.Interop.D3DImage> and best practices when you are using Windows Vista, Windows XP, and multi-monitor displays.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="efc23-107">Para ver ejemplos de código que muestran estos procedimientos recomendados, consulte interoperabilidad de [WPF y Direct3D9](wpf-and-direct3d9-interoperation.md).</span><span class="sxs-lookup"><span data-stu-id="efc23-107">For code examples that demonstrate these best practices, see [WPF and Direct3D9 Interoperation](wpf-and-direct3d9-interoperation.md).</span></span>  
  
## <a name="use-d3dimage-sparingly"></a><span data-ttu-id="efc23-108">Usar D3DImage moderadamente</span><span class="sxs-lookup"><span data-stu-id="efc23-108">Use D3DImage Sparingly</span></span>  
 <span data-ttu-id="efc23-109">El contenido de Direct3D9 hospedado en una <xref:System.Windows.Interop.D3DImage> instancia de no se representa tan rápido como en una aplicación de Direct3D pura.</span><span class="sxs-lookup"><span data-stu-id="efc23-109">Direct3D9 content hosted in a <xref:System.Windows.Interop.D3DImage> instance does not render as fast as in a pure Direct3D application.</span></span> <span data-ttu-id="efc23-110">Copiar la superficie y vaciar el búfer de comandos puede ser una operación costosa.</span><span class="sxs-lookup"><span data-stu-id="efc23-110">Copying the surface and flushing the command buffer can be costly operations.</span></span> <span data-ttu-id="efc23-111">A medida que aumenta <xref:System.Windows.Interop.D3DImage> el número de instancias, se produce un mayor vaciado y se degrada el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="efc23-111">As the number of <xref:System.Windows.Interop.D3DImage> instances increases, more flushing occurs, and performance degrades.</span></span> <span data-ttu-id="efc23-112">Por lo tanto, debe <xref:System.Windows.Interop.D3DImage> usar con moderación.</span><span class="sxs-lookup"><span data-stu-id="efc23-112">Therefore, you should use <xref:System.Windows.Interop.D3DImage> sparingly.</span></span>  
  
## <a name="best-practices-on-windows-vista"></a><span data-ttu-id="efc23-113">Prácticas recomendadas en Windows Vista</span><span class="sxs-lookup"><span data-stu-id="efc23-113">Best Practices on Windows Vista</span></span>  
 <span data-ttu-id="efc23-114">Para obtener el mejor rendimiento en Windows Vista con una pantalla que está configurada para usar el modelo de controladores de pantalla de Windows (WDDM) `IDirect3DDevice9Ex` , cree la superficie de Direct3D9 en un dispositivo.</span><span class="sxs-lookup"><span data-stu-id="efc23-114">For best performance on Windows Vista with a display that is configured to use the Windows Display Driver Model (WDDM), create your Direct3D9 surface on an `IDirect3DDevice9Ex` device.</span></span> <span data-ttu-id="efc23-115">Esto permite el uso compartido de la superficie.</span><span class="sxs-lookup"><span data-stu-id="efc23-115">This enables surface sharing.</span></span> <span data-ttu-id="efc23-116">La tarjeta de vídeo debe admitir `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` las `D3DCAPS2_CANSHARERESOURCE` capacidades del controlador y en Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="efc23-116">The video card must support the `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` and `D3DCAPS2_CANSHARERESOURCE` driver capabilities on Windows Vista.</span></span> <span data-ttu-id="efc23-117">Cualquier otra configuración hace que la superficie se copie a través del software, lo que reduce significativamente el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="efc23-117">Any other settings cause the surface to be copied through software, which reduces performance significantly.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="efc23-118">Si Windows Vista tiene una pantalla que está configurada para usar el modelo de controladores de pantalla de Windows XP (XDDM), la superficie siempre se copia a través del software, independientemente de la configuración.</span><span class="sxs-lookup"><span data-stu-id="efc23-118">If Windows Vista has a display that is configured to use the Windows XP Display Driver Model (XDDM), the surface is always copied through software, regardless of settings.</span></span> <span data-ttu-id="efc23-119">Con la tarjeta de vídeo y la configuración apropiadas, verá un mejor rendimiento en Windows Vista cuando use el WDDM, ya que las copias de superficie se realizan en el hardware.</span><span class="sxs-lookup"><span data-stu-id="efc23-119">With the proper settings and video card, you will see better performance on Windows Vista when you use the WDDM because surface copies are performed in hardware.</span></span>  
  
## <a name="best-practices-on-windows-xp"></a><span data-ttu-id="efc23-120">Prácticas recomendadas en Windows XP</span><span class="sxs-lookup"><span data-stu-id="efc23-120">Best Practices on Windows XP</span></span>  
 <span data-ttu-id="efc23-121">Para obtener el mejor rendimiento en Windows XP, que usa el modelo de controladores de pantalla de Windows XP (XDDM), cree una superficie bloqueable que `IDirect3DSurface9::GetDC` se comporta correctamente cuando se llama al método.</span><span class="sxs-lookup"><span data-stu-id="efc23-121">For best performance on Windows XP, which uses the Windows XP Display Driver Model (XDDM), create a lockable surface that behaves correctly when the `IDirect3DSurface9::GetDC` method is called.</span></span> <span data-ttu-id="efc23-122">Internamente, el `BitBlt` método transfiere la superficie entre dispositivos en el hardware.</span><span class="sxs-lookup"><span data-stu-id="efc23-122">Internally, the `BitBlt` method transfers the surface across devices in hardware.</span></span> <span data-ttu-id="efc23-123">El `GetDC` método siempre funciona en superficies XRGB.</span><span class="sxs-lookup"><span data-stu-id="efc23-123">The `GetDC` method always works on XRGB surfaces.</span></span> <span data-ttu-id="efc23-124">Sin embargo, si el equipo cliente ejecuta Windows XP con SP3 o SP2, y si el cliente también tiene la revisión para la característica de ventana en capas, este método solo funciona en superficies ARGB.</span><span class="sxs-lookup"><span data-stu-id="efc23-124">However, if the client computer is running Windows XP with SP3 or SP2, and if the client also has the hotfix for the layered-window feature, this method only works on ARGB surfaces.</span></span> <span data-ttu-id="efc23-125">La tarjeta de vídeo debe admitir `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` la funcionalidad del controlador.</span><span class="sxs-lookup"><span data-stu-id="efc23-125">The video card must support the `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` driver capability.</span></span>  
  
 <span data-ttu-id="efc23-126">Una profundidad de pantalla de escritorio de 16 bits puede reducir considerablemente el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="efc23-126">A 16-bit desktop display depth can significantly reduce performance.</span></span> <span data-ttu-id="efc23-127">Se recomienda usar un escritorio de 32 bits.</span><span class="sxs-lookup"><span data-stu-id="efc23-127">A 32-bit desktop is recommended.</span></span>  
  
 <span data-ttu-id="efc23-128">Si va a desarrollar para Windows Vista y Windows XP, pruebe el rendimiento en Windows XP.</span><span class="sxs-lookup"><span data-stu-id="efc23-128">If you are developing for Windows Vista and Windows XP, test the performance on Windows XP.</span></span> <span data-ttu-id="efc23-129">La falta de memoria de vídeo en Windows XP es un problema.</span><span class="sxs-lookup"><span data-stu-id="efc23-129">Running out of video memory on Windows XP is a concern.</span></span> <span data-ttu-id="efc23-130">Además, <xref:System.Windows.Interop.D3DImage> en Windows XP usa más memoria de vídeo y ancho de banda que el WDDM de Windows Vista, debido a una copia de memoria de vídeo adicional necesaria.</span><span class="sxs-lookup"><span data-stu-id="efc23-130">In addition, <xref:System.Windows.Interop.D3DImage> on Windows XP uses more video memory and bandwidth than Windows Vista WDDM, due to a necessary extra video memory copy.</span></span> <span data-ttu-id="efc23-131">Por lo tanto, puede esperar que el rendimiento sea peor en Windows XP que en Windows Vista para el mismo hardware de vídeo.</span><span class="sxs-lookup"><span data-stu-id="efc23-131">Therefore, you can expect performance to be worse on Windows XP than on Windows Vista for the same video hardware.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="efc23-132">El XDDM está disponible en Windows XP y Windows Vista; sin embargo, WDDM solo está disponible en Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="efc23-132">XDDM is available on both Windows XP and Windows Vista; however, WDDM is available only on Windows Vista.</span></span>  
  
## <a name="general-best-practices"></a><span data-ttu-id="efc23-133">Procedimientos recomendados generales</span><span class="sxs-lookup"><span data-stu-id="efc23-133">General Best Practices</span></span>  
 <span data-ttu-id="efc23-134">Al crear el dispositivo, use la marca `D3DCREATE_MULTITHREADED` de creación.</span><span class="sxs-lookup"><span data-stu-id="efc23-134">When you create the device, use the `D3DCREATE_MULTITHREADED` creation flag.</span></span> <span data-ttu-id="efc23-135">Esto reduce el rendimiento, pero el sistema de representación de WPF llama a los métodos de este dispositivo desde otro subproceso.</span><span class="sxs-lookup"><span data-stu-id="efc23-135">This reduces performance, but the WPF rendering system calls methods on this device from another thread.</span></span> <span data-ttu-id="efc23-136">Asegúrese de seguir el protocolo de bloqueo correctamente, de modo que no haya dos subprocesos que tengan acceso al dispositivo al mismo tiempo.</span><span class="sxs-lookup"><span data-stu-id="efc23-136">Be sure to follow the locking protocol correctly, so that no two threads access the device at the same time.</span></span>  
  
 <span data-ttu-id="efc23-137">Si la representación se realiza en un subproceso administrado de WPF, se recomienda encarecidamente que cree el dispositivo con la `D3DCREATE_FPU_PRESERVE` marca de creación.</span><span class="sxs-lookup"><span data-stu-id="efc23-137">If your rendering is performed on a WPF managed thread, it is strongly recommended that you create the device with the `D3DCREATE_FPU_PRESERVE` creation flag.</span></span> <span data-ttu-id="efc23-138">Sin esta configuración, la representación D3D puede reducir la precisión de las operaciones de precisión doble de WPF y introducir problemas de representación.</span><span class="sxs-lookup"><span data-stu-id="efc23-138">Without this setting, the D3D rendering can reduce the accuracy of WPF double-precision operations and introduce rendering issues.</span></span>  
  
 <span data-ttu-id="efc23-139">La <xref:System.Windows.Interop.D3DImage> disposición en mosaico es rápida, a menos que se ponga en mosaico una superficie que no sea de pow2 sin compatibilidad <xref:System.Windows.Media.VisualBrush> de hardware, o si se coloca en mosaico un <xref:System.Windows.Media.DrawingBrush> o que contiene <xref:System.Windows.Interop.D3DImage>.</span><span class="sxs-lookup"><span data-stu-id="efc23-139">Tiling a <xref:System.Windows.Interop.D3DImage> is fast, unless you tile a non-pow2 surface without hardware support, or if you tile a <xref:System.Windows.Media.DrawingBrush> or <xref:System.Windows.Media.VisualBrush> that contains a <xref:System.Windows.Interop.D3DImage>.</span></span>  
  
## <a name="best-practices-for-multi-monitor-displays"></a><span data-ttu-id="efc23-140">Prácticas recomendadas para pantallas de varios monitores</span><span class="sxs-lookup"><span data-stu-id="efc23-140">Best Practices for Multi-Monitor Displays</span></span>  
 <span data-ttu-id="efc23-141">Si utiliza un equipo que tiene varios monitores, debe seguir los procedimientos recomendados descritos anteriormente.</span><span class="sxs-lookup"><span data-stu-id="efc23-141">If you are using a computer that has multiple monitors, you should follow the previously described best practices.</span></span> <span data-ttu-id="efc23-142">También hay algunas consideraciones de rendimiento adicionales para una configuración de varios monitores.</span><span class="sxs-lookup"><span data-stu-id="efc23-142">There are also some additional performance considerations for a multi-monitor configuration.</span></span>  
  
 <span data-ttu-id="efc23-143">Al crear el búfer de reserva, se crea en un dispositivo y adaptador específico, pero WPF puede mostrar el búfer frontal en cualquier adaptador.</span><span class="sxs-lookup"><span data-stu-id="efc23-143">When you create the back buffer, it is created on a specific device and adapter, but WPF may display the front buffer on any adapter.</span></span> <span data-ttu-id="efc23-144">La copia entre adaptadores para actualizar el búfer frontal puede ser muy costosa.</span><span class="sxs-lookup"><span data-stu-id="efc23-144">Copying across adapters to update the front buffer can be very expensive.</span></span> <span data-ttu-id="efc23-145">En Windows Vista que está configurado para usar el WDDM con varias tarjetas de vídeo y con `IDirect3DDevice9Ex` un dispositivo, si el búfer frontal está en un adaptador diferente pero sigue siendo la misma tarjeta de vídeo, no hay penalización de rendimiento.</span><span class="sxs-lookup"><span data-stu-id="efc23-145">On Windows Vista that is configured to use the WDDM with multiple video cards and with an `IDirect3DDevice9Ex` device, if the front buffer is on a different adapter but still the same video card, there is no performance penalty.</span></span> <span data-ttu-id="efc23-146">Sin embargo, en Windows XP y el XDDM con varias tarjetas de vídeo, existe una penalización significativa del rendimiento cuando el búfer frontal se muestra en un adaptador diferente del búfer de reserva.</span><span class="sxs-lookup"><span data-stu-id="efc23-146">However, on Windows XP and the XDDM with multiple video cards, there is a significant performance penalty when the front buffer is displayed on a different adapter than the back buffer.</span></span> <span data-ttu-id="efc23-147">Para obtener más información, consulte interoperabilidad de [WPF y Direct3D9](wpf-and-direct3d9-interoperation.md).</span><span class="sxs-lookup"><span data-stu-id="efc23-147">For more information, see [WPF and Direct3D9 Interoperation](wpf-and-direct3d9-interoperation.md).</span></span>  
  
## <a name="performance-summary"></a><span data-ttu-id="efc23-148">Resumen de rendimiento</span><span class="sxs-lookup"><span data-stu-id="efc23-148">Performance Summary</span></span>  
 <span data-ttu-id="efc23-149">En la tabla siguiente se muestra el rendimiento de la actualización del búfer frontal como una función del sistema operativo, el formato de píxel y la protección de la superficie.</span><span class="sxs-lookup"><span data-stu-id="efc23-149">The following table shows performance of the front buffer update as a function of operating system, pixel format, and surface lockability.</span></span> <span data-ttu-id="efc23-150">Se supone que el búfer frontal y el búfer de reserva están en el mismo adaptador.</span><span class="sxs-lookup"><span data-stu-id="efc23-150">The front buffer and back buffer are assumed to be on the same adapter.</span></span> <span data-ttu-id="efc23-151">En función de la configuración del adaptador, las actualizaciones de hardware suelen ser mucho más rápidas que las actualizaciones de software.</span><span class="sxs-lookup"><span data-stu-id="efc23-151">Depending on the adapter configuration, hardware updates are generally much faster than software updates.</span></span>  
  
|<span data-ttu-id="efc23-152">Formato de píxel de superficie</span><span class="sxs-lookup"><span data-stu-id="efc23-152">Surface pixel format</span></span>|<span data-ttu-id="efc23-153">Windows Vista, WDDM y 9Ex</span><span class="sxs-lookup"><span data-stu-id="efc23-153">Windows Vista, WDDM and 9Ex</span></span>|<span data-ttu-id="efc23-154">Otras configuraciones de Windows Vista</span><span class="sxs-lookup"><span data-stu-id="efc23-154">Other Windows Vista configurations</span></span>|<span data-ttu-id="efc23-155">Revisión de Windows XP SP3 o SP2 con</span><span class="sxs-lookup"><span data-stu-id="efc23-155">Windows XP SP3 or SP2 w/ hotfix</span></span>|<span data-ttu-id="efc23-156">Windows XP SP2</span><span class="sxs-lookup"><span data-stu-id="efc23-156">Windows XP SP2</span></span>|  
|--------------------------|---------------------------------|----------------------------------------|--------------------------------------|--------------------|  
|<span data-ttu-id="efc23-157">D3DFMT_X8R8G8B8 (no bloqueable)</span><span class="sxs-lookup"><span data-stu-id="efc23-157">D3DFMT_X8R8G8B8 (not lockable)</span></span>|<span data-ttu-id="efc23-158">**Actualización de hardware**</span><span class="sxs-lookup"><span data-stu-id="efc23-158">**Hardware Update**</span></span>|<span data-ttu-id="efc23-159">Actualización de software</span><span class="sxs-lookup"><span data-stu-id="efc23-159">Software Update</span></span>|<span data-ttu-id="efc23-160">Actualización de software</span><span class="sxs-lookup"><span data-stu-id="efc23-160">Software Update</span></span>|<span data-ttu-id="efc23-161">Actualización de software</span><span class="sxs-lookup"><span data-stu-id="efc23-161">Software Update</span></span>|  
|<span data-ttu-id="efc23-162">D3DFMT_X8R8G8B8 (bloqueable)</span><span class="sxs-lookup"><span data-stu-id="efc23-162">D3DFMT_X8R8G8B8 (lockable)</span></span>|<span data-ttu-id="efc23-163">**Actualización de hardware**</span><span class="sxs-lookup"><span data-stu-id="efc23-163">**Hardware Update**</span></span>|<span data-ttu-id="efc23-164">Actualización de software</span><span class="sxs-lookup"><span data-stu-id="efc23-164">Software Update</span></span>|<span data-ttu-id="efc23-165">**Actualización de hardware**</span><span class="sxs-lookup"><span data-stu-id="efc23-165">**Hardware Update**</span></span>|<span data-ttu-id="efc23-166">**Actualización de hardware**</span><span class="sxs-lookup"><span data-stu-id="efc23-166">**Hardware Update**</span></span>|  
|<span data-ttu-id="efc23-167">D3DFMT_A8R8G8B8 (no bloqueable)</span><span class="sxs-lookup"><span data-stu-id="efc23-167">D3DFMT_A8R8G8B8 (not lockable)</span></span>|<span data-ttu-id="efc23-168">**Actualización de hardware**</span><span class="sxs-lookup"><span data-stu-id="efc23-168">**Hardware Update**</span></span>|<span data-ttu-id="efc23-169">Actualización de software</span><span class="sxs-lookup"><span data-stu-id="efc23-169">Software Update</span></span>|<span data-ttu-id="efc23-170">Actualización de software</span><span class="sxs-lookup"><span data-stu-id="efc23-170">Software Update</span></span>|<span data-ttu-id="efc23-171">Actualización de software</span><span class="sxs-lookup"><span data-stu-id="efc23-171">Software Update</span></span>|  
|<span data-ttu-id="efc23-172">D3DFMT_A8R8G8B8 (bloqueable)</span><span class="sxs-lookup"><span data-stu-id="efc23-172">D3DFMT_A8R8G8B8 (lockable)</span></span>|<span data-ttu-id="efc23-173">**Actualización de hardware**</span><span class="sxs-lookup"><span data-stu-id="efc23-173">**Hardware Update**</span></span>|<span data-ttu-id="efc23-174">Actualización de software</span><span class="sxs-lookup"><span data-stu-id="efc23-174">Software Update</span></span>|<span data-ttu-id="efc23-175">**Actualización de hardware**</span><span class="sxs-lookup"><span data-stu-id="efc23-175">**Hardware Update**</span></span>|<span data-ttu-id="efc23-176">Actualización de software</span><span class="sxs-lookup"><span data-stu-id="efc23-176">Software Update</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="efc23-177">Vea también</span><span class="sxs-lookup"><span data-stu-id="efc23-177">See also</span></span>

- <xref:System.Windows.Interop.D3DImage>
- [<span data-ttu-id="efc23-178">Interoperabilidad entre WPF y Direct3D9</span><span class="sxs-lookup"><span data-stu-id="efc23-178">WPF and Direct3D9 Interoperation</span></span>](wpf-and-direct3d9-interoperation.md)
- [<span data-ttu-id="efc23-179">Tutorial: Crear contenido de Direct3D9 para hospedarlo en WPF</span><span class="sxs-lookup"><span data-stu-id="efc23-179">Walkthrough: Creating Direct3D9 Content for Hosting in WPF</span></span>](walkthrough-creating-direct3d9-content-for-hosting-in-wpf.md)
- [<span data-ttu-id="efc23-180">Tutorial: Hospedar contenido de Direct3D9 en WPF</span><span class="sxs-lookup"><span data-stu-id="efc23-180">Walkthrough: Hosting Direct3D9 Content in WPF</span></span>](walkthrough-hosting-direct3d9-content-in-wpf.md)
