---
title: Modelo de subprocesos
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- text on buttons [WPF], updating
- message processing [WPF], nested
- blocking operations [WPF]
- Common Language Runtime (CLR), locking mechanism
- locking mechanism of Common Language Runtime (CLR)
- threading model [WPF]
- Word [WPF], spelling checking
- button text [WPF], updating
- spelling checking in Word [WPF]
- asynchronous behavior [WPF], exposing
- nested message processing [WPF]
- reentrancy [WPF]
ms.assetid: 02d8fd00-8d7c-4604-874c-58e40786770b
ms.openlocfilehash: 0bcb0e7369345aaae39d99a005a07304aaad7043
ms.sourcegitcommit: 5b6d778ebb269ee6684fb57ad69a8c28b06235b9
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 04/08/2019
ms.locfileid: "59200355"
---
# <a name="threading-model"></a><span data-ttu-id="f01c6-102">Modelo de subprocesos</span><span class="sxs-lookup"><span data-stu-id="f01c6-102">Threading Model</span></span>
[!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] <span data-ttu-id="f01c6-103">está diseñado para evitar a los programadores las dificultades de los subprocesos.</span><span class="sxs-lookup"><span data-stu-id="f01c6-103">is designed to save developers from the difficulties of threading.</span></span> <span data-ttu-id="f01c6-104">Como resultado, la mayoría de [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] los desarrolladores no tienen que escribir una interfaz que usa más de un subproceso.</span><span class="sxs-lookup"><span data-stu-id="f01c6-104">As a result, the majority of [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] developers won't have to write an interface that uses more than one thread.</span></span> <span data-ttu-id="f01c6-105">Dado que los programas multiproceso son complejos y difíciles de depurar, se deben evitar cuando existan soluciones de un único subproceso.</span><span class="sxs-lookup"><span data-stu-id="f01c6-105">Because multithreaded programs are complex and difficult to debug, they should be avoided when single-threaded solutions exist.</span></span>  
  
 <span data-ttu-id="f01c6-106">Importar lo bien no diseñado, sin embargo, no [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] framework nunca será capaz de proporcionar una solución de un solo subproceso para cada tipo de problema.</span><span class="sxs-lookup"><span data-stu-id="f01c6-106">No matter how well architected, however, no [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] framework will ever be able to provide a single-threaded solution for every sort of problem.</span></span> [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <span data-ttu-id="f01c6-107">incluye close, pero todavía hay situaciones en las que varios subprocesos mejoran [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)] rendimiento de la capacidad de respuesta o la aplicación.</span><span class="sxs-lookup"><span data-stu-id="f01c6-107">comes close, but there are still situations where multiple threads improve [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)] responsiveness or application performance.</span></span> <span data-ttu-id="f01c6-108">Después de explicar material básico, en este documento se exploran algunas de estas situaciones y, después, se concluye con una explicación de algunos detalles de nivel inferior.</span><span class="sxs-lookup"><span data-stu-id="f01c6-108">After discussing some background material, this paper explores some of these situations and then concludes with a discussion of some lower-level details.</span></span>  

> [!NOTE]
>  <span data-ttu-id="f01c6-109">En este tema se describe los subprocesos mediante el uso de la <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A> método para las llamadas asincrónicas.</span><span class="sxs-lookup"><span data-stu-id="f01c6-109">This topic discusses threading by using the <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A> method for asynchronous calls.</span></span> <span data-ttu-id="f01c6-110">También puede realizar llamadas asincrónicas mediante una llamada a la <xref:System.Windows.Threading.Dispatcher.InvokeAsync%2A> método, que toman un <xref:System.Action> o <xref:System.Func%601> como un parámetro.</span><span class="sxs-lookup"><span data-stu-id="f01c6-110">You can also make asynchronous calls by calling the <xref:System.Windows.Threading.Dispatcher.InvokeAsync%2A> method, which take an <xref:System.Action> or <xref:System.Func%601> as a parameter.</span></span>  <span data-ttu-id="f01c6-111">El <xref:System.Windows.Threading.Dispatcher.InvokeAsync%2A> método devuelve un <xref:System.Windows.Threading.DispatcherOperation> o <xref:System.Windows.Threading.DispatcherOperation%601>, que tiene un <xref:System.Windows.Threading.DispatcherOperation.Task%2A> propiedad.</span><span class="sxs-lookup"><span data-stu-id="f01c6-111">The <xref:System.Windows.Threading.Dispatcher.InvokeAsync%2A> method returns a <xref:System.Windows.Threading.DispatcherOperation> or <xref:System.Windows.Threading.DispatcherOperation%601>, which has a <xref:System.Windows.Threading.DispatcherOperation.Task%2A> property.</span></span> <span data-ttu-id="f01c6-112">Puede usar el `await` palabra clave with ya sea el <xref:System.Windows.Threading.DispatcherOperation> o asociado <xref:System.Threading.Tasks.Task>.</span><span class="sxs-lookup"><span data-stu-id="f01c6-112">You can use the `await` keyword with either the <xref:System.Windows.Threading.DispatcherOperation> or the associated <xref:System.Threading.Tasks.Task>.</span></span> <span data-ttu-id="f01c6-113">Si tiene que esperar de forma sincrónica el <xref:System.Threading.Tasks.Task> devuelta por un <xref:System.Windows.Threading.DispatcherOperation> o <xref:System.Windows.Threading.DispatcherOperation%601>, llame a la <xref:System.Windows.Threading.TaskExtensions.DispatcherOperationWait%2A> método de extensión.</span><span class="sxs-lookup"><span data-stu-id="f01c6-113">If you need to wait synchronously for the <xref:System.Threading.Tasks.Task> that is returned by a <xref:System.Windows.Threading.DispatcherOperation> or <xref:System.Windows.Threading.DispatcherOperation%601>, call the <xref:System.Windows.Threading.TaskExtensions.DispatcherOperationWait%2A> extension method.</span></span>  <span data-ttu-id="f01c6-114">Una llamada a <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> dará como resultado un interbloqueo.</span><span class="sxs-lookup"><span data-stu-id="f01c6-114">Calling <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> will result in a deadlock.</span></span> <span data-ttu-id="f01c6-115">Para obtener más información sobre el uso de un <xref:System.Threading.Tasks.Task> para realizar operaciones asincrónicas, vea el paralelismo de tareas.</span><span class="sxs-lookup"><span data-stu-id="f01c6-115">For more information about using a <xref:System.Threading.Tasks.Task> to perform asynchronous operations, see Task Parallelism.</span></span>  <span data-ttu-id="f01c6-116">El <xref:System.Windows.Threading.Dispatcher.Invoke%2A> método también tiene sobrecargas que toman un <xref:System.Action> o <xref:System.Func%601> como un parámetro.</span><span class="sxs-lookup"><span data-stu-id="f01c6-116">The <xref:System.Windows.Threading.Dispatcher.Invoke%2A> method also has overloads that take an <xref:System.Action> or <xref:System.Func%601> as a parameter.</span></span>  <span data-ttu-id="f01c6-117">Puede usar el <xref:System.Windows.Threading.Dispatcher.Invoke%2A> método convertir sincrónico llama pasando un delegado, <xref:System.Action> o <xref:System.Func%601>.</span><span class="sxs-lookup"><span data-stu-id="f01c6-117">You can use the <xref:System.Windows.Threading.Dispatcher.Invoke%2A> method to make synchronous calls by passing in a delegate, <xref:System.Action> or <xref:System.Func%601>.</span></span>  
  
<a name="threading_overview"></a>   
## <a name="overview-and-the-dispatcher"></a><span data-ttu-id="f01c6-118">Información general y el distribuidor</span><span class="sxs-lookup"><span data-stu-id="f01c6-118">Overview and the Dispatcher</span></span>  
 <span data-ttu-id="f01c6-119">Por lo general, [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] aplicaciones se inician con dos subprocesos: uno para controlar la representación y otro para administrar la [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f01c6-119">Typically, [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] applications start with two threads: one for handling rendering and another for managing the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)].</span></span> <span data-ttu-id="f01c6-120">El subproceso de representación se ejecuta eficazmente oculto en segundo plano mientras el [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] subproceso recibe la entrada, controla los eventos, dibuja la pantalla y se ejecuta el código de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="f01c6-120">The rendering thread effectively runs hidden in the background while the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread receives input, handles events, paints the screen, and runs application code.</span></span> <span data-ttu-id="f01c6-121">La mayoría de las aplicaciones utilizan una sola [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] de subproceso, aunque en algunos casos es mejor utilizar varios.</span><span class="sxs-lookup"><span data-stu-id="f01c6-121">Most applications use a single [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread, although in some situations it is best to use several.</span></span> <span data-ttu-id="f01c6-122">Trataremos esto con un ejemplo más adelante.</span><span class="sxs-lookup"><span data-stu-id="f01c6-122">We’ll discuss this with an example later.</span></span>  
  
 <span data-ttu-id="f01c6-123">El [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] colas de subprocesos funcionan elementos dentro de un objeto denominado un <xref:System.Windows.Threading.Dispatcher>.</span><span class="sxs-lookup"><span data-stu-id="f01c6-123">The [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread queues work items inside an object called a <xref:System.Windows.Threading.Dispatcher>.</span></span> <span data-ttu-id="f01c6-124"><xref:System.Windows.Threading.Dispatcher> selecciona los elementos de trabajo en función de la prioridad y ejecuta cada uno hasta que se completan.</span><span class="sxs-lookup"><span data-stu-id="f01c6-124">The <xref:System.Windows.Threading.Dispatcher> selects work items on a priority basis and runs each one to completion.</span></span>  <span data-ttu-id="f01c6-125">Cada [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] subproceso debe tener al menos un <xref:System.Windows.Threading.Dispatcher>y cada <xref:System.Windows.Threading.Dispatcher> pueden ejecutar los elementos de trabajo en un único subproceso.</span><span class="sxs-lookup"><span data-stu-id="f01c6-125">Every [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread must have at least one <xref:System.Windows.Threading.Dispatcher>, and each <xref:System.Windows.Threading.Dispatcher> can execute work items in exactly one thread.</span></span>  
  
 <span data-ttu-id="f01c6-126">El truco para compilar aplicaciones con capacidad de respuesta y fáciles de usar es maximizar la <xref:System.Windows.Threading.Dispatcher> rendimiento manteniendo los elementos de trabajo pequeño.</span><span class="sxs-lookup"><span data-stu-id="f01c6-126">The trick to building responsive, user-friendly applications is to maximize the <xref:System.Windows.Threading.Dispatcher> throughput by keeping the work items small.</span></span> <span data-ttu-id="f01c6-127">Esta forma, los elementos nunca quedan obsoletos en la <xref:System.Windows.Threading.Dispatcher> cola de espera de procesamiento.</span><span class="sxs-lookup"><span data-stu-id="f01c6-127">This way items never get stale sitting in the <xref:System.Windows.Threading.Dispatcher> queue waiting for processing.</span></span> <span data-ttu-id="f01c6-128">Cualquier retraso perceptible entre la entrada y la respuesta puede frustrar a un usuario.</span><span class="sxs-lookup"><span data-stu-id="f01c6-128">Any perceivable delay between input and response can frustrate a user.</span></span>  
  
 <span data-ttu-id="f01c6-129">¿Cómo, a continuación, son [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] supone que las aplicaciones para administrar grandes operaciones?</span><span class="sxs-lookup"><span data-stu-id="f01c6-129">How then are [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] applications supposed to handle big operations?</span></span> <span data-ttu-id="f01c6-130">¿Qué ocurre si el código implica un cálculo grande o necesita consultar una base de datos de algún servidor remoto?</span><span class="sxs-lookup"><span data-stu-id="f01c6-130">What if your code involves a large calculation or needs to query a database on some remote server?</span></span> <span data-ttu-id="f01c6-131">Normalmente, la respuesta es administrar la operación grande en un subproceso independiente, dejando el [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] subproceso libre tienden a los elementos de la <xref:System.Windows.Threading.Dispatcher> cola.</span><span class="sxs-lookup"><span data-stu-id="f01c6-131">Usually, the answer is to handle the big operation in a separate thread, leaving the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread free to tend to items in the <xref:System.Windows.Threading.Dispatcher> queue.</span></span> <span data-ttu-id="f01c6-132">Una vez completada la operación grande, puede informar de su resultado a la [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] subproceso para su presentación.</span><span class="sxs-lookup"><span data-stu-id="f01c6-132">When the big operation is complete, it can report its result back to the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread for display.</span></span>  
  
 <span data-ttu-id="f01c6-133">Históricamente, [!INCLUDE[TLA#tla_mswin](../../../../includes/tlasharptla-mswin-md.md)] permite [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] elementos para tener acceso a solo el subproceso que los creó.</span><span class="sxs-lookup"><span data-stu-id="f01c6-133">Historically, [!INCLUDE[TLA#tla_mswin](../../../../includes/tlasharptla-mswin-md.md)] allows [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] elements to be accessed only by the thread that created them.</span></span> <span data-ttu-id="f01c6-134">Esto significa que un subproceso en segundo plano a cargo de una tarea de ejecución prolongada no puede actualizar un cuadro de texto cuando finalice.</span><span class="sxs-lookup"><span data-stu-id="f01c6-134">This means that a background thread in charge of some long-running task cannot update a text box when it is finished.</span></span> [!INCLUDE[TLA#tla_mswin](../../../../includes/tlasharptla-mswin-md.md)] <span data-ttu-id="f01c6-135">hace esto para garantizar la integridad de [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] componentes.</span><span class="sxs-lookup"><span data-stu-id="f01c6-135">does this to ensure the integrity of [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] components.</span></span> <span data-ttu-id="f01c6-136">Un cuadro de lista podría tener una apariencia extraña si un subproceso en segundo plano actualiza su contenido durante la presentación.</span><span class="sxs-lookup"><span data-stu-id="f01c6-136">A list box could look strange if its contents were updated by a background thread during painting.</span></span>  
  
 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <span data-ttu-id="f01c6-137">tiene un mecanismo de exclusión mutua integrado que aplica esta coordinación.</span><span class="sxs-lookup"><span data-stu-id="f01c6-137">has a built-in mutual exclusion mechanism that enforces this coordination.</span></span> <span data-ttu-id="f01c6-138">La mayoría de clases [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] derivan <xref:System.Windows.Threading.DispatcherObject>.</span><span class="sxs-lookup"><span data-stu-id="f01c6-138">Most classes in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] derive from <xref:System.Windows.Threading.DispatcherObject>.</span></span> <span data-ttu-id="f01c6-139">En la construcción, un <xref:System.Windows.Threading.DispatcherObject> almacena una referencia a la <xref:System.Windows.Threading.Dispatcher> vinculada al subproceso que se está ejecutando.</span><span class="sxs-lookup"><span data-stu-id="f01c6-139">At construction, a <xref:System.Windows.Threading.DispatcherObject> stores a reference to the <xref:System.Windows.Threading.Dispatcher> linked to the currently running thread.</span></span> <span data-ttu-id="f01c6-140">De hecho, el <xref:System.Windows.Threading.DispatcherObject> asocia con el subproceso que lo crea.</span><span class="sxs-lookup"><span data-stu-id="f01c6-140">In effect, the <xref:System.Windows.Threading.DispatcherObject> associates with the thread that creates it.</span></span> <span data-ttu-id="f01c6-141">Durante la ejecución del programa, un <xref:System.Windows.Threading.DispatcherObject> puede llamar a su público <xref:System.Windows.Threading.DispatcherObject.VerifyAccess%2A> método.</span><span class="sxs-lookup"><span data-stu-id="f01c6-141">During program execution, a <xref:System.Windows.Threading.DispatcherObject> can call its public <xref:System.Windows.Threading.DispatcherObject.VerifyAccess%2A> method.</span></span> <xref:System.Windows.Threading.DispatcherObject.VerifyAccess%2A> <span data-ttu-id="f01c6-142">examina la <xref:System.Windows.Threading.Dispatcher> asociada al subproceso actual y lo compara con el <xref:System.Windows.Threading.Dispatcher> almacenada durante la construcción de referencia.</span><span class="sxs-lookup"><span data-stu-id="f01c6-142">examines the <xref:System.Windows.Threading.Dispatcher> associated with the current thread and compares it to the <xref:System.Windows.Threading.Dispatcher> reference stored during construction.</span></span> <span data-ttu-id="f01c6-143">Si no coinciden, <xref:System.Windows.Threading.DispatcherObject.VerifyAccess%2A> produce una excepción.</span><span class="sxs-lookup"><span data-stu-id="f01c6-143">If they don’t match, <xref:System.Windows.Threading.DispatcherObject.VerifyAccess%2A> throws an exception.</span></span> <xref:System.Windows.Threading.DispatcherObject.VerifyAccess%2A> <span data-ttu-id="f01c6-144">está pensado para ser invocado al principio de cada método perteneciente a un <xref:System.Windows.Threading.DispatcherObject>.</span><span class="sxs-lookup"><span data-stu-id="f01c6-144">is intended to be called at the beginning of every method belonging to a <xref:System.Windows.Threading.DispatcherObject>.</span></span>  
  
 <span data-ttu-id="f01c6-145">Si solo un subproceso puede modificar el [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)], ¿cómo interactúan los subprocesos en segundo plano con el usuario?</span><span class="sxs-lookup"><span data-stu-id="f01c6-145">If only one thread can modify the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)], how do background threads interact with the user?</span></span> <span data-ttu-id="f01c6-146">Un subproceso en segundo plano puede pedir el [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] subproceso para realizar una operación en su nombre.</span><span class="sxs-lookup"><span data-stu-id="f01c6-146">A background thread can ask the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread to perform an operation on its behalf.</span></span> <span data-ttu-id="f01c6-147">Esto lo consigue registrando un elemento de trabajo con el <xref:System.Windows.Threading.Dispatcher> de la [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] subproceso.</span><span class="sxs-lookup"><span data-stu-id="f01c6-147">It does this by registering a work item with the <xref:System.Windows.Threading.Dispatcher> of the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread.</span></span> <span data-ttu-id="f01c6-148">El <xref:System.Windows.Threading.Dispatcher> clase proporciona dos métodos para registrar los elementos de trabajo: <xref:System.Windows.Threading.Dispatcher.Invoke%2A> y <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A>.</span><span class="sxs-lookup"><span data-stu-id="f01c6-148">The <xref:System.Windows.Threading.Dispatcher> class provides two methods for registering work items: <xref:System.Windows.Threading.Dispatcher.Invoke%2A> and <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A>.</span></span> <span data-ttu-id="f01c6-149">Ambos métodos programan un delegado para que se ejecute.</span><span class="sxs-lookup"><span data-stu-id="f01c6-149">Both methods schedule a delegate for execution.</span></span> <xref:System.Windows.Threading.Dispatcher.Invoke%2A> <span data-ttu-id="f01c6-150">es una llamada sincrónica: es decir, no vuelve hasta que el [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] subproceso termina de ejecutar el delegado.</span><span class="sxs-lookup"><span data-stu-id="f01c6-150">is a synchronous call – that is, it doesn’t return until the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread actually finishes executing the delegate.</span></span> <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A> <span data-ttu-id="f01c6-151">es asincrónico y vuelve inmediatamente.</span><span class="sxs-lookup"><span data-stu-id="f01c6-151">is asynchronous and returns immediately.</span></span>  
  
 <span data-ttu-id="f01c6-152">El <xref:System.Windows.Threading.Dispatcher> ordena los elementos en la cola por prioridad.</span><span class="sxs-lookup"><span data-stu-id="f01c6-152">The <xref:System.Windows.Threading.Dispatcher> orders the elements in its queue by priority.</span></span> <span data-ttu-id="f01c6-153">Hay diez niveles que se pueden especificar cuando se agrega un elemento a la <xref:System.Windows.Threading.Dispatcher> cola.</span><span class="sxs-lookup"><span data-stu-id="f01c6-153">There are ten levels that may be specified when adding an element to the <xref:System.Windows.Threading.Dispatcher> queue.</span></span> <span data-ttu-id="f01c6-154">Estas prioridades se mantienen en el <xref:System.Windows.Threading.DispatcherPriority> enumeración.</span><span class="sxs-lookup"><span data-stu-id="f01c6-154">These priorities are maintained in the <xref:System.Windows.Threading.DispatcherPriority> enumeration.</span></span> <span data-ttu-id="f01c6-155">Más información sobre <xref:System.Windows.Threading.DispatcherPriority> niveles pueden encontrarse en el [!INCLUDE[TLA2#tla_winfxsdk](../../../../includes/tla2sharptla-winfxsdk-md.md)] documentación.</span><span class="sxs-lookup"><span data-stu-id="f01c6-155">Detailed information about <xref:System.Windows.Threading.DispatcherPriority> levels can be found in the [!INCLUDE[TLA2#tla_winfxsdk](../../../../includes/tla2sharptla-winfxsdk-md.md)] documentation.</span></span>  
  
<a name="samples"></a>   
## <a name="threads-in-action-the-samples"></a><span data-ttu-id="f01c6-156">Subprocesos en acción: Los ejemplos</span><span class="sxs-lookup"><span data-stu-id="f01c6-156">Threads in Action: The Samples</span></span>  
  
<a name="prime_number"></a>   
### <a name="a-single-threaded-application-with-a-long-running-calculation"></a><span data-ttu-id="f01c6-157">Una aplicación de un único subproceso con un cálculo de ejecución prolongada</span><span class="sxs-lookup"><span data-stu-id="f01c6-157">A Single-Threaded Application with a Long-Running Calculation</span></span>  
 <span data-ttu-id="f01c6-158">La mayoría [!INCLUDE[TLA#tla_gui#plural](../../../../includes/tlasharptla-guisharpplural-md.md)] dedican una gran parte de su tiempo de inactividad mientras espera eventos que se generan en respuesta a interacciones del usuario.</span><span class="sxs-lookup"><span data-stu-id="f01c6-158">Most [!INCLUDE[TLA#tla_gui#plural](../../../../includes/tlasharptla-guisharpplural-md.md)] spend a large portion of their time idle while waiting for events that are generated in response to user interactions.</span></span> <span data-ttu-id="f01c6-159">Con una programación se puede usar este tiempo de inactividad constructiva, sin que afecte a la capacidad de respuesta de la [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f01c6-159">With careful programming this idle time can be used constructively, without affecting the responsiveness of the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)].</span></span> <span data-ttu-id="f01c6-160">El [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] modelo de subprocesos no permite que la entrada interrumpa una operación que sucede en el [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] subproceso.</span><span class="sxs-lookup"><span data-stu-id="f01c6-160">The [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] threading model doesn’t allow input to interrupt an operation happening in the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread.</span></span> <span data-ttu-id="f01c6-161">Esto significa que debe asegurarse de volver a la <xref:System.Windows.Threading.Dispatcher> periódicamente para procesar eventos de entrada antes de que queden obsoletos pendientes.</span><span class="sxs-lookup"><span data-stu-id="f01c6-161">This means you must be sure to return to the <xref:System.Windows.Threading.Dispatcher> periodically to process pending input events before they get stale.</span></span>  
  
 <span data-ttu-id="f01c6-162">Considere el ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="f01c6-162">Consider the following example:</span></span>  
  
 ![Captura de pantalla que muestra los subprocesos de números primos.](./media/threading-model/threading-prime-numbers.png)  
  
 <span data-ttu-id="f01c6-164">Esta sencilla aplicación cuenta en orden ascendente a partir de tres, buscando números primos.</span><span class="sxs-lookup"><span data-stu-id="f01c6-164">This simple application counts upwards from three, searching for prime numbers.</span></span> <span data-ttu-id="f01c6-165">Cuando el usuario hace clic en el **iniciar** botón, la búsqueda comienza.</span><span class="sxs-lookup"><span data-stu-id="f01c6-165">When the user clicks the **Start** button, the search begins.</span></span> <span data-ttu-id="f01c6-166">Cuando el programa encuentra un número primo, actualiza la interfaz de usuario con su detección.</span><span class="sxs-lookup"><span data-stu-id="f01c6-166">When the program finds a prime, it updates the user interface with its discovery.</span></span> <span data-ttu-id="f01c6-167">En cualquier momento, el usuario puede detener la búsqueda.</span><span class="sxs-lookup"><span data-stu-id="f01c6-167">At any point, the user can stop the search.</span></span>  
  
 <span data-ttu-id="f01c6-168">Aunque es bastante simple, la búsqueda de números primos podría continuar para siempre, lo que presenta algunas dificultades.</span><span class="sxs-lookup"><span data-stu-id="f01c6-168">Although simple enough, the prime number search could go on forever, which presents some difficulties.</span></span>  <span data-ttu-id="f01c6-169">Si se controla la búsqueda completa dentro del controlador de eventos click del botón, nunca nos daría el [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] una oportunidad para controlar otros eventos de subproceso.</span><span class="sxs-lookup"><span data-stu-id="f01c6-169">If we handled the entire search inside of the click event handler of the button, we would never give the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread a chance to handle other events.</span></span> <span data-ttu-id="f01c6-170">El [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] sería no puede responder a la entrada ni procesar mensajes.</span><span class="sxs-lookup"><span data-stu-id="f01c6-170">The [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] would be unable to respond to input or process messages.</span></span> <span data-ttu-id="f01c6-171">No se volvería a dibujar nunca y tampoco respondería a los clics de botón.</span><span class="sxs-lookup"><span data-stu-id="f01c6-171">It would never repaint and never respond to button clicks.</span></span>  
  
 <span data-ttu-id="f01c6-172">Se podría realizar la búsqueda de números primos en un subproceso independiente, pero entonces sería necesario solucionar problemas de sincronización.</span><span class="sxs-lookup"><span data-stu-id="f01c6-172">We could conduct the prime number search in a separate thread, but then we would need to deal with synchronization issues.</span></span> <span data-ttu-id="f01c6-173">Con un enfoque de un único subproceso, se puede actualizar directamente la etiqueta que muestra el número primo mayor encontrado.</span><span class="sxs-lookup"><span data-stu-id="f01c6-173">With a single-threaded approach, we can directly update the label that lists the largest prime found.</span></span>  
  
 <span data-ttu-id="f01c6-174">Si se divide la tarea de cálculo en fragmentos manejables, podemos volver periódicamente a la <xref:System.Windows.Threading.Dispatcher> y procesar eventos.</span><span class="sxs-lookup"><span data-stu-id="f01c6-174">If we break up the task of calculation into manageable chunks, we can periodically return to the <xref:System.Windows.Threading.Dispatcher> and process events.</span></span> <span data-ttu-id="f01c6-175">Podemos poner [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] una oportunidad para volver a dibujar y procesar la entrada.</span><span class="sxs-lookup"><span data-stu-id="f01c6-175">We can give [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] an opportunity to repaint and process input.</span></span>  
  
 <span data-ttu-id="f01c6-176">La mejor manera de dividir el tiempo de procesamiento entre el cálculo y control de eventos es administrar el cálculo desde el <xref:System.Windows.Threading.Dispatcher>.</span><span class="sxs-lookup"><span data-stu-id="f01c6-176">The best way to split processing time between calculation and event handling is to manage calculation from the <xref:System.Windows.Threading.Dispatcher>.</span></span> <span data-ttu-id="f01c6-177">Mediante el uso de la <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A> método, se pueden programar las comprobaciones de números primos en la misma que la cola [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] se extraen de los eventos.</span><span class="sxs-lookup"><span data-stu-id="f01c6-177">By using the <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A> method, we can schedule prime number checks in the same queue that [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] events are drawn from.</span></span> <span data-ttu-id="f01c6-178">En el ejemplo, solamente se programa una comprobación de número primo cada vez.</span><span class="sxs-lookup"><span data-stu-id="f01c6-178">In our example, we schedule only a single prime number check at a time.</span></span> <span data-ttu-id="f01c6-179">Una vez completada la comprobación de número primo, se programa la siguiente de manera inmediata.</span><span class="sxs-lookup"><span data-stu-id="f01c6-179">After the prime number check is complete, we schedule the next check immediately.</span></span> <span data-ttu-id="f01c6-180">Esta comprobación se realiza solamente después pendientes [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] han sido controlados o eventos.</span><span class="sxs-lookup"><span data-stu-id="f01c6-180">This check proceeds only after pending [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] events have been handled.</span></span>  
  
 ![Captura de pantalla que muestra la cola del distribuidor.](./media/threading-model/threading-dispatcher-queue.png)  
  
 [!INCLUDE[TLA#tla_word](../../../../includes/tlasharptla-word-md.md)] <span data-ttu-id="f01c6-182">lleva a cabo la revisión ortográfica mediante este mecanismo.</span><span class="sxs-lookup"><span data-stu-id="f01c6-182">accomplishes spell checking using this mechanism.</span></span> <span data-ttu-id="f01c6-183">Corrector ortográfico se realiza en segundo plano con el tiempo de inactividad de la [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] subproceso.</span><span class="sxs-lookup"><span data-stu-id="f01c6-183">Spell checking is done in the background using the idle time of the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread.</span></span> <span data-ttu-id="f01c6-184">Echemos un vistazo al código.</span><span class="sxs-lookup"><span data-stu-id="f01c6-184">Let's take a look at the code.</span></span>  
  
 <span data-ttu-id="f01c6-185">En el ejemplo siguiente se muestra el XAML que crea la interfaz de usuario.</span><span class="sxs-lookup"><span data-stu-id="f01c6-185">The following example shows the XAML that creates the user interface.</span></span>  
  
 [!code-xaml[ThreadingPrimeNumbers#ThreadingPrimeNumberXAML](~/samples/snippets/csharp/VS_Snippets_Wpf/ThreadingPrimeNumbers/CSharp/Window1.xaml#threadingprimenumberxaml)]  
  
 <span data-ttu-id="f01c6-186">En el ejemplo siguiente se muestra el código subyacente.</span><span class="sxs-lookup"><span data-stu-id="f01c6-186">The following example shows the code-behind.</span></span>  
  
 [!code-csharp[ThreadingPrimeNumbers#ThreadingPrimeNumberCodeBehind](~/samples/snippets/csharp/VS_Snippets_Wpf/ThreadingPrimeNumbers/CSharp/Window1.xaml.cs#threadingprimenumbercodebehind)]
 [!code-vb[ThreadingPrimeNumbers#ThreadingPrimeNumberCodeBehind](~/samples/snippets/visualbasic/VS_Snippets_Wpf/ThreadingPrimeNumbers/visualbasic/mainwindow.xaml.vb#threadingprimenumbercodebehind)]  
  
 <span data-ttu-id="f01c6-187">El ejemplo siguiente muestra el controlador de eventos para el <xref:System.Windows.Controls.Button>.</span><span class="sxs-lookup"><span data-stu-id="f01c6-187">The following example shows the event handler for the <xref:System.Windows.Controls.Button>.</span></span>  
  
 [!code-csharp[ThreadingPrimeNumbers#ThreadingPrimeNumberStartOrStop](~/samples/snippets/csharp/VS_Snippets_Wpf/ThreadingPrimeNumbers/CSharp/Window1.xaml.cs#threadingprimenumberstartorstop)]
 [!code-vb[ThreadingPrimeNumbers#ThreadingPrimeNumberStartOrStop](~/samples/snippets/visualbasic/VS_Snippets_Wpf/ThreadingPrimeNumbers/visualbasic/mainwindow.xaml.vb#threadingprimenumberstartorstop)]  
  
 <span data-ttu-id="f01c6-188">Además de actualizar el texto en el <xref:System.Windows.Controls.Button>, este controlador es responsable de programar la primera comprobación de número primo agregando un delegado para el <xref:System.Windows.Threading.Dispatcher> cola.</span><span class="sxs-lookup"><span data-stu-id="f01c6-188">Besides updating the text on the <xref:System.Windows.Controls.Button>, this handler is responsible for scheduling the first prime number check by adding a delegate to the <xref:System.Windows.Threading.Dispatcher> queue.</span></span> <span data-ttu-id="f01c6-189">En ocasiones, después de este controlador de eventos ha finalizado su trabajo, el <xref:System.Windows.Threading.Dispatcher> seleccionará este delegado para la ejecución.</span><span class="sxs-lookup"><span data-stu-id="f01c6-189">Sometime after this event handler has completed its work, the <xref:System.Windows.Threading.Dispatcher> will select this delegate for execution.</span></span>  
  
 <span data-ttu-id="f01c6-190">Como mencionamos anteriormente, <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A> es el <xref:System.Windows.Threading.Dispatcher> miembro que se usa para programar un delegado para la ejecución.</span><span class="sxs-lookup"><span data-stu-id="f01c6-190">As we mentioned earlier, <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A> is the <xref:System.Windows.Threading.Dispatcher> member used to schedule a delegate for execution.</span></span> <span data-ttu-id="f01c6-191">En este caso, elegimos el <xref:System.Windows.Threading.DispatcherPriority.SystemIdle> prioridad.</span><span class="sxs-lookup"><span data-stu-id="f01c6-191">In this case, we choose the <xref:System.Windows.Threading.DispatcherPriority.SystemIdle> priority.</span></span> <span data-ttu-id="f01c6-192">El <xref:System.Windows.Threading.Dispatcher> se ejecutará este delegado sólo cuando no hay ningún evento importante por procesar.</span><span class="sxs-lookup"><span data-stu-id="f01c6-192">The <xref:System.Windows.Threading.Dispatcher> will execute this delegate only when there are no important events to process.</span></span> [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] <span data-ttu-id="f01c6-193">la capacidad de respuesta es más importante que la comprobación de números.</span><span class="sxs-lookup"><span data-stu-id="f01c6-193">responsiveness is more important than number checking.</span></span> <span data-ttu-id="f01c6-194">También se pasa un nuevo delegado que representa la rutina de comprobación de números.</span><span class="sxs-lookup"><span data-stu-id="f01c6-194">We also pass a new delegate representing the number-checking routine.</span></span>  
  
 [!code-csharp[ThreadingPrimeNumbers#ThreadingPrimeNumberCheckNextNumber](~/samples/snippets/csharp/VS_Snippets_Wpf/ThreadingPrimeNumbers/CSharp/Window1.xaml.cs#threadingprimenumberchecknextnumber)]
 [!code-vb[ThreadingPrimeNumbers#ThreadingPrimeNumberCheckNextNumber](~/samples/snippets/visualbasic/VS_Snippets_Wpf/ThreadingPrimeNumbers/visualbasic/mainwindow.xaml.vb#threadingprimenumberchecknextnumber)]  
  
 <span data-ttu-id="f01c6-195">Este método comprueba si el siguiente número impar es primo.</span><span class="sxs-lookup"><span data-stu-id="f01c6-195">This method checks if the next odd number is prime.</span></span> <span data-ttu-id="f01c6-196">Si es primo, el método actualiza directamente el `bigPrime`<xref:System.Windows.Controls.TextBlock> para reflejar su detección.</span><span class="sxs-lookup"><span data-stu-id="f01c6-196">If it is prime, the method directly updates the `bigPrime`<xref:System.Windows.Controls.TextBlock> to reflect its discovery.</span></span> <span data-ttu-id="f01c6-197">Se puede hacer porque el cálculo se está produciendo en el mismo subproceso que se ha usado para crear el componente.</span><span class="sxs-lookup"><span data-stu-id="f01c6-197">We can do this because the calculation is occurring in the same thread that was used to create the component.</span></span> <span data-ttu-id="f01c6-198">Si hubiéramos decidido usar un subproceso independiente para el cálculo, tendríamos que usar un mecanismo de sincronización más complicado y ejecutar la actualización en el [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] subproceso.</span><span class="sxs-lookup"><span data-stu-id="f01c6-198">Had we chosen to use a separate thread for the calculation, we would have to use a more complicated synchronization mechanism and execute the update in the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread.</span></span> <span data-ttu-id="f01c6-199">A continuación se mostrará esta situación.</span><span class="sxs-lookup"><span data-stu-id="f01c6-199">We’ll demonstrate this situation next.</span></span>  
  
 <span data-ttu-id="f01c6-200">Para el código fuente completo para este ejemplo, vea el [Single-Threaded Application with Long-Running Calculation Sample](https://go.microsoft.com/fwlink/?LinkID=160038)</span><span class="sxs-lookup"><span data-stu-id="f01c6-200">For the complete source code for this sample, see the [Single-Threaded Application with Long-Running Calculation Sample](https://go.microsoft.com/fwlink/?LinkID=160038)</span></span>  
  
<a name="weather_sim"></a>   
### <a name="handling-a-blocking-operation-with-a-background-thread"></a><span data-ttu-id="f01c6-201">Control de una operación de bloqueo con un subproceso en segundo plano</span><span class="sxs-lookup"><span data-stu-id="f01c6-201">Handling a Blocking Operation with a Background Thread</span></span>  
 <span data-ttu-id="f01c6-202">El control de operaciones de bloqueo en una aplicación gráfica puede ser difícil.</span><span class="sxs-lookup"><span data-stu-id="f01c6-202">Handling blocking operations in a graphical application can be difficult.</span></span> <span data-ttu-id="f01c6-203">No es recomendable llamar a métodos de bloqueo desde controladores de eventos, porque parecerá que la aplicación se inmoviliza.</span><span class="sxs-lookup"><span data-stu-id="f01c6-203">We don’t want to call blocking methods from event handlers because the application will appear to freeze up.</span></span> <span data-ttu-id="f01c6-204">Podemos usar un subproceso independiente para administrar estas operaciones, pero cuando hayamos terminados, será necesario sincronizar con el [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] subprocesos porque no podemos modificar directamente el [!INCLUDE[TLA2#tla_gui](../../../../includes/tla2sharptla-gui-md.md)] desde el subproceso de trabajo.</span><span class="sxs-lookup"><span data-stu-id="f01c6-204">We can use a separate thread to handle these operations, but when we’re done, we have to synchronize with the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread because we can’t directly modify the [!INCLUDE[TLA2#tla_gui](../../../../includes/tla2sharptla-gui-md.md)] from our worker thread.</span></span> <span data-ttu-id="f01c6-205">Podemos usar <xref:System.Windows.Threading.Dispatcher.Invoke%2A> o <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A> para insertar delegados en el <xref:System.Windows.Threading.Dispatcher> de la [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] subproceso.</span><span class="sxs-lookup"><span data-stu-id="f01c6-205">We can use <xref:System.Windows.Threading.Dispatcher.Invoke%2A> or <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A> to insert delegates into the <xref:System.Windows.Threading.Dispatcher> of the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread.</span></span> <span data-ttu-id="f01c6-206">Finalmente, estos delegados se ejecutarán con permiso para modificar [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] elementos.</span><span class="sxs-lookup"><span data-stu-id="f01c6-206">Eventually, these delegates will be executed with permission to modify [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] elements.</span></span>  
  
 <span data-ttu-id="f01c6-207">En este ejemplo, se imita una llamada a procedimiento remoto que recupera la previsión meteorológica.</span><span class="sxs-lookup"><span data-stu-id="f01c6-207">In this example, we mimic a remote procedure call that retrieves a weather forecast.</span></span> <span data-ttu-id="f01c6-208">Se usa un subproceso de trabajo independiente para ejecutar esta llamada y se programa un método de actualización en el <xref:System.Windows.Threading.Dispatcher> de la [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] subprocesos cuando hayamos terminado.</span><span class="sxs-lookup"><span data-stu-id="f01c6-208">We use a separate worker thread to execute this call, and we schedule an update method in the <xref:System.Windows.Threading.Dispatcher> of the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread when we’re finished.</span></span>  
  
 ![Captura de pantalla que muestre el tiempo en la interfaz de usuario.](./media/threading-model/threading-weather-ui.png)  
  
 [!code-csharp[ThreadingWeatherForecast#ThreadingWeatherCodeBehind](~/samples/snippets/csharp/VS_Snippets_Wpf/ThreadingWeatherForecast/CSharp/Window1.xaml.cs#threadingweathercodebehind)]
 [!code-vb[ThreadingWeatherForecast#ThreadingWeatherCodeBehind](~/samples/snippets/visualbasic/VS_Snippets_Wpf/ThreadingWeatherForecast/visualbasic/window1.xaml.vb#threadingweathercodebehind)]  
  
 <span data-ttu-id="f01c6-210">A continuación se enumeran algunos de los detalles para tener en cuenta.</span><span class="sxs-lookup"><span data-stu-id="f01c6-210">The following are some of the details to be noted.</span></span>  
  
-   <span data-ttu-id="f01c6-211">Creación del controlador del botón</span><span class="sxs-lookup"><span data-stu-id="f01c6-211">Creating the Button Handler</span></span>  
  
     [!code-csharp[ThreadingWeatherForecast#ThreadingWeatherButtonHandler](~/samples/snippets/csharp/VS_Snippets_Wpf/ThreadingWeatherForecast/CSharp/Window1.xaml.cs#threadingweatherbuttonhandler)]
     [!code-vb[ThreadingWeatherForecast#ThreadingWeatherButtonHandler](~/samples/snippets/visualbasic/VS_Snippets_Wpf/ThreadingWeatherForecast/visualbasic/window1.xaml.vb#threadingweatherbuttonhandler)]  
  
 <span data-ttu-id="f01c6-212">Cuando se hace clic en el botón, se muestra el dibujo del reloj y se inicia su animación.</span><span class="sxs-lookup"><span data-stu-id="f01c6-212">When the button is clicked, we display the clock drawing and start animating it.</span></span> <span data-ttu-id="f01c6-213">Se deshabilita el botón.</span><span class="sxs-lookup"><span data-stu-id="f01c6-213">We disable the button.</span></span> <span data-ttu-id="f01c6-214">Se invoca el `FetchWeatherFromServer` un método en un nuevo subproceso y, a continuación, se return, lo que permite el <xref:System.Windows.Threading.Dispatcher> para procesar los eventos mientras se espera para recopilar la previsión meteorológica.</span><span class="sxs-lookup"><span data-stu-id="f01c6-214">We invoke the `FetchWeatherFromServer` method in a new thread, and then we return, allowing the <xref:System.Windows.Threading.Dispatcher> to process events while we wait to collect the weather forecast.</span></span>  
  
-   <span data-ttu-id="f01c6-215">Captura de la información meteorológica</span><span class="sxs-lookup"><span data-stu-id="f01c6-215">Fetching the Weather</span></span>  
  
     [!code-csharp[ThreadingWeatherForecast#ThreadingWeatherFetchWeather](~/samples/snippets/csharp/VS_Snippets_Wpf/ThreadingWeatherForecast/CSharp/Window1.xaml.cs#threadingweatherfetchweather)]
     [!code-vb[ThreadingWeatherForecast#ThreadingWeatherFetchWeather](~/samples/snippets/visualbasic/VS_Snippets_Wpf/ThreadingWeatherForecast/visualbasic/window1.xaml.vb#threadingweatherfetchweather)]  
  
 <span data-ttu-id="f01c6-216">Para simplificar las cosas, en realidad en este ejemplo no hay ningún código de red.</span><span class="sxs-lookup"><span data-stu-id="f01c6-216">To keep things simple, we don’t actually have any networking code in this example.</span></span> <span data-ttu-id="f01c6-217">En su lugar, es posible simular el retraso de acceso de red haciendo que el nuevo subproceso espere durante cuatro segundos.</span><span class="sxs-lookup"><span data-stu-id="f01c6-217">Instead, we simulate the delay of network access by putting our new thread to sleep for four seconds.</span></span> <span data-ttu-id="f01c6-218">En este momento, el original [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] subproceso aún se esté ejecutando y responder a eventos.</span><span class="sxs-lookup"><span data-stu-id="f01c6-218">In this time, the original [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread is still running and responding to events.</span></span> <span data-ttu-id="f01c6-219">Para mostrarlo, se deja una animación en ejecución y los botones para minimizar y maximizar también siguen funcionando.</span><span class="sxs-lookup"><span data-stu-id="f01c6-219">To show this, we’ve left an animation running, and the minimize and maximize buttons also continue to work.</span></span>  
  
 <span data-ttu-id="f01c6-220">Cuando finaliza el retraso, y hemos seleccionado aleatoriamente la previsión meteorológica, es el momento de informar a los [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] subproceso.</span><span class="sxs-lookup"><span data-stu-id="f01c6-220">When the delay is finished, and we’ve randomly selected our weather forecast, it’s time to report back to the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread.</span></span> <span data-ttu-id="f01c6-221">Esto se realiza una llamada a la programación `UpdateUserInterface` en el [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] subprocesos mediante ese subproceso <xref:System.Windows.Threading.Dispatcher>.</span><span class="sxs-lookup"><span data-stu-id="f01c6-221">We do this by scheduling a call to `UpdateUserInterface` in the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread using that thread’s <xref:System.Windows.Threading.Dispatcher>.</span></span> <span data-ttu-id="f01c6-222">Se pasa una cadena que describe la información meteorológica a esta llamada de método programada.</span><span class="sxs-lookup"><span data-stu-id="f01c6-222">We pass a string describing the weather to this scheduled method call.</span></span>  
  
-   <span data-ttu-id="f01c6-223">Actualizando el</span><span class="sxs-lookup"><span data-stu-id="f01c6-223">Updating the</span></span> [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]  
  
     [!code-csharp[ThreadingWeatherForecast#ThreadingWeatherUpdateUI](~/samples/snippets/csharp/VS_Snippets_Wpf/ThreadingWeatherForecast/CSharp/Window1.xaml.cs#threadingweatherupdateui)]
     [!code-vb[ThreadingWeatherForecast#ThreadingWeatherUpdateUI](~/samples/snippets/visualbasic/VS_Snippets_Wpf/ThreadingWeatherForecast/visualbasic/window1.xaml.vb#threadingweatherupdateui)]  
  
 <span data-ttu-id="f01c6-224">Cuando el <xref:System.Windows.Threading.Dispatcher> en el [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] subproceso tiene tiempo, ejecuta la llamada programada a `UpdateUserInterface`.</span><span class="sxs-lookup"><span data-stu-id="f01c6-224">When the <xref:System.Windows.Threading.Dispatcher> in the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread has time, it executes the scheduled call to `UpdateUserInterface`.</span></span> <span data-ttu-id="f01c6-225">Este método detiene la animación del reloj y elige una imagen que describa la información meteorológica.</span><span class="sxs-lookup"><span data-stu-id="f01c6-225">This method stops the clock animation and chooses an image to describe the weather.</span></span> <span data-ttu-id="f01c6-226">Muestra esta imagen y restaura el botón para "obtener la información meteorológica".</span><span class="sxs-lookup"><span data-stu-id="f01c6-226">It displays this image and restores the "fetch forecast" button.</span></span>  
  
<a name="multi_browser"></a>   
### <a name="multiple-windows-multiple-threads"></a><span data-ttu-id="f01c6-227">Varias ventanas, varios subprocesos</span><span class="sxs-lookup"><span data-stu-id="f01c6-227">Multiple Windows, Multiple Threads</span></span>  
 <span data-ttu-id="f01c6-228">Algunos [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] aplicaciones requieren varias ventanas de nivel superior.</span><span class="sxs-lookup"><span data-stu-id="f01c6-228">Some [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] applications require multiple top-level windows.</span></span> <span data-ttu-id="f01c6-229">Es perfectamente aceptable para un subproceso /<xref:System.Windows.Threading.Dispatcher> combinación para administrar varias ventanas, pero a veces varios subprocesos hacer mejor su trabajo.</span><span class="sxs-lookup"><span data-stu-id="f01c6-229">It is perfectly acceptable for one Thread/<xref:System.Windows.Threading.Dispatcher> combination to manage multiple windows, but sometimes several threads do a better job.</span></span> <span data-ttu-id="f01c6-230">Esto es especialmente cierto si hay alguna posibilidad de que una de las ventanas monopolice el subproceso.</span><span class="sxs-lookup"><span data-stu-id="f01c6-230">This is especially true if there is any chance that one of the windows will monopolize the thread.</span></span>  
  
 [!INCLUDE[TLA#tla_mswin](../../../../includes/tlasharptla-mswin-md.md)] <span data-ttu-id="f01c6-231">Explorador funciona de esta manera.</span><span class="sxs-lookup"><span data-stu-id="f01c6-231">Explorer works in this fashion.</span></span> <span data-ttu-id="f01c6-232">Cada nueva ventana del Explorador pertenece al proceso original, pero se crea bajo el control de un subproceso independiente.</span><span class="sxs-lookup"><span data-stu-id="f01c6-232">Each new Explorer window belongs to the original process, but it is created under the control of an independent thread.</span></span>  
  
 <span data-ttu-id="f01c6-233">Mediante el uso de un [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]<xref:System.Windows.Controls.Frame> control, podemos mostrar páginas Web.</span><span class="sxs-lookup"><span data-stu-id="f01c6-233">By using a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]<xref:System.Windows.Controls.Frame> control, we can display Web pages.</span></span> <span data-ttu-id="f01c6-234">Podemos crear fácilmente un sencillo [!INCLUDE[TLA2#tla_ie](../../../../includes/tla2sharptla-ie-md.md)] sustituir.</span><span class="sxs-lookup"><span data-stu-id="f01c6-234">We can easily create a simple [!INCLUDE[TLA2#tla_ie](../../../../includes/tla2sharptla-ie-md.md)] substitute.</span></span> <span data-ttu-id="f01c6-235">Comenzamos con una característica importante: la capacidad de abrir una nueva ventana del explorador.</span><span class="sxs-lookup"><span data-stu-id="f01c6-235">We start with an important feature: the ability to open a new explorer window.</span></span> <span data-ttu-id="f01c6-236">Cuando el usuario hace clic en el botón "Nueva ventana", se inicia una copia de nuestra ventana en un subproceso independiente.</span><span class="sxs-lookup"><span data-stu-id="f01c6-236">When the user clicks the "new window" button, we launch a copy of our window in a separate thread.</span></span> <span data-ttu-id="f01c6-237">De este modo, las operaciones de ejecución prolongada o de bloqueo en una de las ventanas no bloquearán a todas las demás.</span><span class="sxs-lookup"><span data-stu-id="f01c6-237">This way, long-running or blocking operations in one of the windows won’t lock all the other windows.</span></span>  
  
 <span data-ttu-id="f01c6-238">En realidad, el modelo de explorador web tiene su propio modelo complicado de subprocesos.</span><span class="sxs-lookup"><span data-stu-id="f01c6-238">In reality, the Web browser model has its own complicated threading model.</span></span> <span data-ttu-id="f01c6-239">Lo elegimos porque debería resultar conocido para la mayoría de los lectores.</span><span class="sxs-lookup"><span data-stu-id="f01c6-239">We’ve chosen it because it should be familiar to most readers.</span></span>  
  
 <span data-ttu-id="f01c6-240">En el ejemplo siguiente se muestra el código.</span><span class="sxs-lookup"><span data-stu-id="f01c6-240">The following example shows the code.</span></span>  
  
 [!code-xaml[ThreadingMultipleBrowsers#ThreadingMultiBrowserXAML](~/samples/snippets/csharp/VS_Snippets_Wpf/ThreadingMultipleBrowsers/CSharp/Window1.xaml#threadingmultibrowserxaml)]  
  
 [!code-csharp[ThreadingMultipleBrowsers#ThreadingMultiBrowserCodeBehind](~/samples/snippets/csharp/VS_Snippets_Wpf/ThreadingMultipleBrowsers/CSharp/Window1.xaml.cs#threadingmultibrowsercodebehind)]
 [!code-vb[ThreadingMultipleBrowsers#ThreadingMultiBrowserCodeBehind](~/samples/snippets/visualbasic/VS_Snippets_Wpf/ThreadingMultipleBrowsers/VisualBasic/Window1.xaml.vb#threadingmultibrowsercodebehind)]  
  
 <span data-ttu-id="f01c6-241">Los siguientes segmentos de subprocesos de este código son los que más nos interesan en este contexto:</span><span class="sxs-lookup"><span data-stu-id="f01c6-241">The following threading segments of this code are the most interesting to us in this context:</span></span>  
  
 [!code-csharp[ThreadingMultipleBrowsers#ThreadingMultiBrowserNewWindow](~/samples/snippets/csharp/VS_Snippets_Wpf/ThreadingMultipleBrowsers/CSharp/Window1.xaml.cs#threadingmultibrowsernewwindow)]
 [!code-vb[ThreadingMultipleBrowsers#ThreadingMultiBrowserNewWindow](~/samples/snippets/visualbasic/VS_Snippets_Wpf/ThreadingMultipleBrowsers/VisualBasic/Window1.xaml.vb#threadingmultibrowsernewwindow)]  
  
 <span data-ttu-id="f01c6-242">Este método se llama cuando se hace clic en el botón "Nueva ventana".</span><span class="sxs-lookup"><span data-stu-id="f01c6-242">This method is called when the "new window" button is clicked.</span></span> <span data-ttu-id="f01c6-243">Crea un nuevo subproceso y lo inicia de forma asincrónica.</span><span class="sxs-lookup"><span data-stu-id="f01c6-243">It creates a new thread and starts it asynchronously.</span></span>  
  
 [!code-csharp[ThreadingMultipleBrowsers#ThreadingMultiBrowserThreadStart](~/samples/snippets/csharp/VS_Snippets_Wpf/ThreadingMultipleBrowsers/CSharp/Window1.xaml.cs#threadingmultibrowserthreadstart)]
 [!code-vb[ThreadingMultipleBrowsers#ThreadingMultiBrowserThreadStart](~/samples/snippets/visualbasic/VS_Snippets_Wpf/ThreadingMultipleBrowsers/VisualBasic/Window1.xaml.vb#threadingmultibrowserthreadstart)]  
  
 <span data-ttu-id="f01c6-244">Este método es el punto de partida para el nuevo subproceso.</span><span class="sxs-lookup"><span data-stu-id="f01c6-244">This method is the starting point for the new thread.</span></span> <span data-ttu-id="f01c6-245">Se crea una nueva ventana bajo el control de este subproceso.</span><span class="sxs-lookup"><span data-stu-id="f01c6-245">We create a new window under the control of this thread.</span></span> [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <span data-ttu-id="f01c6-246">crea automáticamente un nuevo <xref:System.Windows.Threading.Dispatcher> para administrar el nuevo subproceso.</span><span class="sxs-lookup"><span data-stu-id="f01c6-246">automatically creates a new <xref:System.Windows.Threading.Dispatcher> to manage the new thread.</span></span> <span data-ttu-id="f01c6-247">Todo lo que tenemos que hacer para que la ventana sea funcional es iniciar el <xref:System.Windows.Threading.Dispatcher>.</span><span class="sxs-lookup"><span data-stu-id="f01c6-247">All we have to do to make the window functional is to start the <xref:System.Windows.Threading.Dispatcher>.</span></span>  
  
<a name="stumbling_points"></a>   
## <a name="technical-details-and-stumbling-points"></a><span data-ttu-id="f01c6-248">Detalles técnicos y puntos problemáticos</span><span class="sxs-lookup"><span data-stu-id="f01c6-248">Technical Details and Stumbling Points</span></span>  
  
### <a name="writing-components-using-threading"></a><span data-ttu-id="f01c6-249">Escribir componentes mediante subprocesos</span><span class="sxs-lookup"><span data-stu-id="f01c6-249">Writing Components Using Threading</span></span>  
 <span data-ttu-id="f01c6-250">Guía de Microsoft .NET Framework Developer describe un patrón de cómo un componente puede exponer comportamiento asincrónico a sus clientes (vea [Event-based Asynchronous Pattern Overview](../../../standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md)).</span><span class="sxs-lookup"><span data-stu-id="f01c6-250">The Microsoft .NET Framework Developer's Guide describes a pattern for how a component can expose asynchronous behavior to its clients (see [Event-based Asynchronous Pattern Overview](../../../standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md)).</span></span> <span data-ttu-id="f01c6-251">Por ejemplo, suponga que quiere empaquetar el `FetchWeatherFromServer` método en un componente reutilizable,.</span><span class="sxs-lookup"><span data-stu-id="f01c6-251">For instance, suppose we wanted to package the `FetchWeatherFromServer` method into a reusable, nongraphical component.</span></span> <span data-ttu-id="f01c6-252">Siguiendo el patrón estándar de Microsoft .NET Framework, esto sería algo parecido a lo siguiente.</span><span class="sxs-lookup"><span data-stu-id="f01c6-252">Following the standard Microsoft .NET Framework pattern, this would look something like the following.</span></span>  
  
 [!code-csharp[CommandingOverviewSnippets#ThreadingArticleWeatherComponent1](~/samples/snippets/csharp/VS_Snippets_Wpf/CommandingOverviewSnippets/CSharp/Window1.xaml.cs#threadingarticleweathercomponent1)]
 [!code-vb[CommandingOverviewSnippets#ThreadingArticleWeatherComponent1](~/samples/snippets/visualbasic/VS_Snippets_Wpf/CommandingOverviewSnippets/visualbasic/window1.xaml.vb#threadingarticleweathercomponent1)]  
  
 `GetWeatherAsync` <span data-ttu-id="f01c6-253">usaría una de las técnicas descritas anteriormente, como la creación de un subproceso en segundo plano, para realizar el trabajo de forma asincrónica, no bloquea el subproceso de llamada.</span><span class="sxs-lookup"><span data-stu-id="f01c6-253">would use one of the techniques described earlier, such as creating a background thread, to do the work asynchronously, not blocking the calling thread.</span></span>  
  
 <span data-ttu-id="f01c6-254">Una de las partes más importantes de este patrón es llamar a la *MethodName* `Completed` método en el mismo subproceso que llama el *MethodName* `Async` que comience con método.</span><span class="sxs-lookup"><span data-stu-id="f01c6-254">One of the most important parts of this pattern is calling the *MethodName*`Completed` method on the same thread that called the *MethodName*`Async` method to begin with.</span></span> <span data-ttu-id="f01c6-255">Podrían hacerlo mediante [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] bastante sencilla, almacenando <xref:System.Windows.Threading.Dispatcher.CurrentDispatcher%2A>, pero, a continuación, el componente no gráfico solo podría usarse en [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] aplicaciones, no en [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] o [!INCLUDE[TLA#tla_aspnet](../../../../includes/tlasharptla-aspnet-md.md)] programas.</span><span class="sxs-lookup"><span data-stu-id="f01c6-255">You could do this using [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] fairly easily, by storing <xref:System.Windows.Threading.Dispatcher.CurrentDispatcher%2A>—but then the nongraphical component could only be used in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] applications, not in [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] or [!INCLUDE[TLA#tla_aspnet](../../../../includes/tlasharptla-aspnet-md.md)] programs.</span></span>  
  
 <span data-ttu-id="f01c6-256">El <xref:System.Windows.Threading.DispatcherSynchronizationContext> clase satisface esta necesidad, puede considerar como una versión simplificada de <xref:System.Windows.Threading.Dispatcher> que funciona con otros [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] marcos también.</span><span class="sxs-lookup"><span data-stu-id="f01c6-256">The <xref:System.Windows.Threading.DispatcherSynchronizationContext> class addresses this need—think of it as a simplified version of <xref:System.Windows.Threading.Dispatcher> that works with other [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] frameworks as well.</span></span>  
  
 [!code-csharp[CommandingOverviewSnippets#ThreadingArticleWeatherComponent2](~/samples/snippets/csharp/VS_Snippets_Wpf/CommandingOverviewSnippets/CSharp/Window1.xaml.cs#threadingarticleweathercomponent2)]
 [!code-vb[CommandingOverviewSnippets#ThreadingArticleWeatherComponent2](~/samples/snippets/visualbasic/VS_Snippets_Wpf/CommandingOverviewSnippets/visualbasic/window1.xaml.vb#threadingarticleweathercomponent2)]  
  
### <a name="nested-pumping"></a><span data-ttu-id="f01c6-257">Bombeo anidado</span><span class="sxs-lookup"><span data-stu-id="f01c6-257">Nested Pumping</span></span>  
 <span data-ttu-id="f01c6-258">A veces no es factible bloquear completamente el [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] subproceso.</span><span class="sxs-lookup"><span data-stu-id="f01c6-258">Sometimes it is not feasible to completely lock up the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread.</span></span> <span data-ttu-id="f01c6-259">Consideremos el <xref:System.Windows.MessageBox.Show%2A> método de la <xref:System.Windows.MessageBox> clase.</span><span class="sxs-lookup"><span data-stu-id="f01c6-259">Let’s consider the <xref:System.Windows.MessageBox.Show%2A> method of the <xref:System.Windows.MessageBox> class.</span></span> <xref:System.Windows.MessageBox.Show%2A> <span data-ttu-id="f01c6-260">no vuelve hasta que el usuario hace clic en el botón Aceptar.</span><span class="sxs-lookup"><span data-stu-id="f01c6-260">doesn’t return until the user clicks the OK button.</span></span> <span data-ttu-id="f01c6-261">Pero crea una ventana que debe tener un bucle de mensajes para poder ser interactiva.</span><span class="sxs-lookup"><span data-stu-id="f01c6-261">It does, however, create a window that must have a message loop in order to be interactive.</span></span> <span data-ttu-id="f01c6-262">Mientras se espera a que el usuario haga clic en Aceptar, la ventana de la aplicación original no responde a la entrada del usuario.</span><span class="sxs-lookup"><span data-stu-id="f01c6-262">While we are waiting for the user to click OK, the original application window does not respond to user input.</span></span> <span data-ttu-id="f01c6-263">Pero sigue procesando los mensajes de pintura.</span><span class="sxs-lookup"><span data-stu-id="f01c6-263">It does, however, continue to process paint messages.</span></span> <span data-ttu-id="f01c6-264">La ventana original se vuelve a dibujar cuando se oculta y se muestra.</span><span class="sxs-lookup"><span data-stu-id="f01c6-264">The original window redraws itself when covered and revealed.</span></span>  
  
 ![Captura de pantalla que muestra un cuadro de mensajes con un botón Aceptar](./media/threading-model/threading-message-loop.png)  
  
 <span data-ttu-id="f01c6-266">Algún subproceso debe estar a cargo de la ventana del cuadro de mensaje.</span><span class="sxs-lookup"><span data-stu-id="f01c6-266">Some thread must be in charge of the message box window.</span></span> [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <span data-ttu-id="f01c6-267">podría crear un nuevo subproceso para la ventana del cuadro de mensaje, pero este subproceso no podrá representar los elementos deshabilitados en la ventana original (recuerde la explicación anterior sobre la exclusión mutua).</span><span class="sxs-lookup"><span data-stu-id="f01c6-267">could create a new thread just for the message box window, but this thread would be unable to paint the disabled elements in the original window (remember the earlier discussion of mutual exclusion).</span></span> <span data-ttu-id="f01c6-268">En su lugar, [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] utiliza un sistema de procesamiento de mensajes anidados.</span><span class="sxs-lookup"><span data-stu-id="f01c6-268">Instead, [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] uses a nested message processing system.</span></span> <span data-ttu-id="f01c6-269">El <xref:System.Windows.Threading.Dispatcher> clase incluye un método especial denominado <xref:System.Windows.Threading.Dispatcher.PushFrame%2A>, que almacena el punto de ejecución actual de la aplicación, a continuación, comienza un nuevo bucle de mensajes.</span><span class="sxs-lookup"><span data-stu-id="f01c6-269">The <xref:System.Windows.Threading.Dispatcher> class includes a special method called <xref:System.Windows.Threading.Dispatcher.PushFrame%2A>, which stores an application’s current execution point then begins a new message loop.</span></span> <span data-ttu-id="f01c6-270">Cuando finaliza el bucle de mensajes anidados, se reanuda la ejecución después del original <xref:System.Windows.Threading.Dispatcher.PushFrame%2A> llamar.</span><span class="sxs-lookup"><span data-stu-id="f01c6-270">When the nested message loop finishes, execution resumes after the original <xref:System.Windows.Threading.Dispatcher.PushFrame%2A> call.</span></span>  
  
 <span data-ttu-id="f01c6-271">En este caso, <xref:System.Windows.Threading.Dispatcher.PushFrame%2A> mantiene el contexto de programa en la llamada a <xref:System.Windows.MessageBox>.<xref:System.Windows.MessageBox.Show%2A>, y se inicia un nuevo bucle de mensajes para volver a dibujar la ventana de fondo y controlar la entrada de la ventana del cuadro de mensaje.</span><span class="sxs-lookup"><span data-stu-id="f01c6-271">In this case, <xref:System.Windows.Threading.Dispatcher.PushFrame%2A> maintains the program context at the call to <xref:System.Windows.MessageBox>.<xref:System.Windows.MessageBox.Show%2A>, and it starts a new message loop to repaint the background window and handle input to the message box window.</span></span> <span data-ttu-id="f01c6-272">Cuando el usuario hace clic en Aceptar y borra la ventana emergente, se sale del bucle anidado y se reanuda el control después de llamar a <xref:System.Windows.MessageBox.Show%2A>.</span><span class="sxs-lookup"><span data-stu-id="f01c6-272">When the user clicks OK and clears the pop-up window, the nested loop exits and control resumes after the call to <xref:System.Windows.MessageBox.Show%2A>.</span></span>  
  
### <a name="stale-routed-events"></a><span data-ttu-id="f01c6-273">Eventos enrutados obsoletos</span><span class="sxs-lookup"><span data-stu-id="f01c6-273">Stale Routed Events</span></span>  
 <span data-ttu-id="f01c6-274">El sistema de eventos enrutados en [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] notifica a los árboles completos cuando se generan eventos.</span><span class="sxs-lookup"><span data-stu-id="f01c6-274">The routed event system in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] notifies entire trees when events are raised.</span></span>  
  
 [!code-xaml[InputOvw#ThreadingArticleStaticRoutedEvent](~/samples/snippets/csharp/VS_Snippets_Wpf/InputOvw/CSharp/Page1.xaml#threadingarticlestaticroutedevent)]  
  
 <span data-ttu-id="f01c6-275">Cuando se presiona el botón primario del mouse sobre la elipse, `handler2` se ejecuta.</span><span class="sxs-lookup"><span data-stu-id="f01c6-275">When the left mouse button is pressed over the ellipse, `handler2` is executed.</span></span> <span data-ttu-id="f01c6-276">Después de `handler2` finaliza, el evento se pasa a la <xref:System.Windows.Controls.Canvas> objeto, que usa `handler1` para procesarlo.</span><span class="sxs-lookup"><span data-stu-id="f01c6-276">After `handler2` finishes, the event is passed along to the <xref:System.Windows.Controls.Canvas> object, which uses `handler1` to process it.</span></span> <span data-ttu-id="f01c6-277">Esto solo sucede si `handler2` no marca explícitamente el objeto de evento como controlado.</span><span class="sxs-lookup"><span data-stu-id="f01c6-277">This happens only if `handler2` does not explicitly mark the event object as handled.</span></span>  
  
 <span data-ttu-id="f01c6-278">Es posible que `handler2` tardará mucho tiempo en procesar este evento.</span><span class="sxs-lookup"><span data-stu-id="f01c6-278">It’s possible that `handler2` will take a great deal of time processing this event.</span></span> `handler2` <span data-ttu-id="f01c6-279">Puede usar <xref:System.Windows.Threading.Dispatcher.PushFrame%2A> para iniciar un bucle de mensajes anidados que no devuelve durante horas.</span><span class="sxs-lookup"><span data-stu-id="f01c6-279">might use <xref:System.Windows.Threading.Dispatcher.PushFrame%2A> to begin a nested message loop that doesn’t return for hours.</span></span> <span data-ttu-id="f01c6-280">Si `handler2` no marca el evento como controlado cuando este bucle de mensajes está completa, el evento se pasa al árbol aunque sea muy antiguo.</span><span class="sxs-lookup"><span data-stu-id="f01c6-280">If `handler2` does not mark the event as handled when this message loop is complete, the event is passed up the tree even though it is very old.</span></span>  
  
### <a name="reentrancy-and-locking"></a><span data-ttu-id="f01c6-281">Reentrada y bloqueo</span><span class="sxs-lookup"><span data-stu-id="f01c6-281">Reentrancy and Locking</span></span>  
 <span data-ttu-id="f01c6-282">El mecanismo de bloqueo de la [!INCLUDE[TLA#tla_clr](../../../../includes/tlasharptla-clr-md.md)] no se comporta exactamente como se podría imaginar; se podría esperar que un subproceso dejara de funcionar completamente cuando se solicita un bloqueo.</span><span class="sxs-lookup"><span data-stu-id="f01c6-282">The locking mechanism of the [!INCLUDE[TLA#tla_clr](../../../../includes/tlasharptla-clr-md.md)] doesn’t behave exactly as one might imagine; one might expect a thread to cease operation completely when requesting a lock.</span></span> <span data-ttu-id="f01c6-283">En realidad, el subproceso continúa recibiendo y procesando mensajes de alta prioridad.</span><span class="sxs-lookup"><span data-stu-id="f01c6-283">In actuality, the thread continues to receive and process high-priority messages.</span></span> <span data-ttu-id="f01c6-284">Esto ayuda a evitar interbloqueos y a que la capacidad de respuesta de las interfaces sea mínima, pero introduce la posibilidad de errores sutiles.</span><span class="sxs-lookup"><span data-stu-id="f01c6-284">This helps prevent deadlocks and make interfaces minimally responsive, but it introduces the possibility for subtle bugs.</span></span>  <span data-ttu-id="f01c6-285">La mayoría de las veces no es necesario saber nada acerca de esto, pero en raras circunstancias (normalmente implican [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] los mensajes de ventana o componentes COM STA) puede ser conveniente saberlo.</span><span class="sxs-lookup"><span data-stu-id="f01c6-285">The vast majority of the time you don’t need to know anything about this, but under rare circumstances (usually involving [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window messages or COM STA components) this can be worth knowing.</span></span>  
  
 <span data-ttu-id="f01c6-286">Mayoría de las interfaces no se compila con la seguridad para subprocesos en mente porque los desarrolladores trabajan bajo el supuesto de que un [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] nunca se tiene acceso a más de un subproceso.</span><span class="sxs-lookup"><span data-stu-id="f01c6-286">Most interfaces are not built with thread safety in mind because developers work under the assumption that a [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] is never accessed by more than one thread.</span></span> <span data-ttu-id="f01c6-287">En este caso, que el único subproceso puede realizar cambios en el entorno en momentos inesperados, provocando esos mal efectos que el <xref:System.Windows.Threading.DispatcherObject> mecanismo de exclusión mutua supuestamente debe para resolver.</span><span class="sxs-lookup"><span data-stu-id="f01c6-287">In this case, that single thread may make environmental changes at unexpected times, causing those ill effects that the <xref:System.Windows.Threading.DispatcherObject> mutual exclusion mechanism is supposed to solve.</span></span> <span data-ttu-id="f01c6-288">Considere el siguiente seudocódigo:</span><span class="sxs-lookup"><span data-stu-id="f01c6-288">Consider the following pseudocode:</span></span>  
  
 <span data-ttu-id="f01c6-289">![Diagrama que muestra la reentrada de subprocesos. ](./media/threading-model/threading-reentrancy.png "ThreadingReentrancy")</span><span class="sxs-lookup"><span data-stu-id="f01c6-289">![Diagram that shows threading reentrancy.](./media/threading-model/threading-reentrancy.png "ThreadingReentrancy")</span></span>  
  
 <span data-ttu-id="f01c6-290">La mayoría de las veces que es lo correcto, pero hay ocasiones en [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] donde esa reentrada inesperada realmente puede causar problemas.</span><span class="sxs-lookup"><span data-stu-id="f01c6-290">Most of the time that’s the right thing, but there are times in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] where such unexpected reentrancy can really cause problems.</span></span> <span data-ttu-id="f01c6-291">Por tanto, en determinados momentos clave, [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] llamadas <xref:System.Windows.Threading.Dispatcher.DisableProcessing%2A>, que cambia la instrucción de bloqueo de ese subproceso para que use el [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] bloqueo sin reentrada, en lugar de la habitual [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] bloqueo.</span><span class="sxs-lookup"><span data-stu-id="f01c6-291">So, at certain key times, [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] calls <xref:System.Windows.Threading.Dispatcher.DisableProcessing%2A>, which changes the lock instruction for that thread to use the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] reentrancy-free lock, instead of the usual [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] lock.</span></span>  
  
 <span data-ttu-id="f01c6-292">¿Por qué hizo el [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] equipo elegir este comportamiento?</span><span class="sxs-lookup"><span data-stu-id="f01c6-292">So why did the [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] team choose this behavior?</span></span> <span data-ttu-id="f01c6-293">Tenía que ver con los objetos COM STA y el subproceso de finalización.</span><span class="sxs-lookup"><span data-stu-id="f01c6-293">It had to do with COM STA objects and the finalization thread.</span></span> <span data-ttu-id="f01c6-294">Cuando un objeto se recolectan, su `Finalize` método se ejecuta en el subproceso finalizador dedicado, no el [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] subproceso.</span><span class="sxs-lookup"><span data-stu-id="f01c6-294">When an object is garbage collected, its `Finalize` method is run on the dedicated finalizer thread, not the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread.</span></span> <span data-ttu-id="f01c6-295">Y en él se encuentra el problema, porque un objeto COM STA que se creó en el [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] sólo se puede desechar el subproceso en el [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] subproceso.</span><span class="sxs-lookup"><span data-stu-id="f01c6-295">And therein lies the problem, because a COM STA object that was created on the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread can only be disposed on the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread.</span></span> <span data-ttu-id="f01c6-296">El [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] realiza el equivalente de un <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A> (en este caso, uso de Win32 `SendMessage`).</span><span class="sxs-lookup"><span data-stu-id="f01c6-296">The [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] does the equivalent of a <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A> (in this case using Win32’s `SendMessage`).</span></span> <span data-ttu-id="f01c6-297">Pero si el [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] subproceso está ocupado, el subproceso del finalizador se ha detenido y no se puede eliminar el objeto COM STA, lo que crea una pérdida de memoria graves.</span><span class="sxs-lookup"><span data-stu-id="f01c6-297">But if the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread is busy, the finalizer thread is stalled and the COM STA object can’t be disposed, which creates a serious memory leak.</span></span> <span data-ttu-id="f01c6-298">Por lo que la [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] equipo ha realizado la difícil decisión que bloqueos funcione como lo hacen.</span><span class="sxs-lookup"><span data-stu-id="f01c6-298">So the [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] team made the tough call to make locks work the way they do.</span></span>  
  
 <span data-ttu-id="f01c6-299">La tarea para [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] es evitar la reentrada inesperada sin volver a introducir la fuga de memoria, lo que no bloqueamos la reentrada en todas partes.</span><span class="sxs-lookup"><span data-stu-id="f01c6-299">The task for [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] is to avoid unexpected reentrancy without reintroducing the memory leak, which is why we don’t block reentrancy everywhere.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="f01c6-300">Vea también</span><span class="sxs-lookup"><span data-stu-id="f01c6-300">See also</span></span>

- [<span data-ttu-id="f01c6-301">Single-Threaded Application with Long-Running Calculation Sample</span><span class="sxs-lookup"><span data-stu-id="f01c6-301">Single-Threaded Application with Long-Running Calculation Sample</span></span>](https://go.microsoft.com/fwlink/?LinkID=160038)
