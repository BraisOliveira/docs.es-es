---
title: Procedimiento para bloquear puntos de conexión en la empresa
ms.date: 03/30/2017
ms.assetid: 1b7eaab7-da60-4cf7-9d6a-ec02709cf75d
ms.openlocfilehash: ae4884cb0dcc1b1bdf81d98a9c7a7a87e836af1b
ms.sourcegitcommit: 2701302a99cafbe0d86d53d540eb0fa7e9b46b36
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 04/28/2019
ms.locfileid: "64606232"
---
# <a name="how-to-lock-down-endpoints-in-the-enterprise"></a><span data-ttu-id="7a701-102">Procedimiento para bloquear puntos de conexión en la empresa</span><span class="sxs-lookup"><span data-stu-id="7a701-102">How to: Lock Down Endpoints in the Enterprise</span></span>
<span data-ttu-id="7a701-103">Las grandes empresas requieren a menudo que las aplicaciones se desarrollen conforme a las directivas de seguridad de la empresa.</span><span class="sxs-lookup"><span data-stu-id="7a701-103">Large enterprises often require that applications are developed in compliance with enterprise security policies.</span></span> <span data-ttu-id="7a701-104">El siguiente tema describe cómo desarrollar e instalar un validador de punto de conexión de cliente que puede usarse para validar todas las aplicaciones cliente de Windows Communication Foundation (WCF) instaladas en los equipos.</span><span class="sxs-lookup"><span data-stu-id="7a701-104">The following topic discusses how to develop and install a client endpoint validator that can be used to validate all Windows Communication Foundation (WCF) client applications installed on computers.</span></span>  
  
 <span data-ttu-id="7a701-105">En este caso, el validador es un validador de cliente porque este comportamiento de punto de conexión se agrega al cliente [ \<commonBehaviors >](../../../../docs/framework/configure-apps/file-schema/wcf/commonbehaviors.md) sección en el archivo machine.config.</span><span class="sxs-lookup"><span data-stu-id="7a701-105">In this case, the validator is a client validator because this endpoint behavior is added to the client [\<commonBehaviors>](../../../../docs/framework/configure-apps/file-schema/wcf/commonbehaviors.md) section in the machine.config file.</span></span> <span data-ttu-id="7a701-106">WCF carga los comportamientos de extremo comunes solo para las aplicaciones cliente y carga los comportamientos de servicio comunes solo para aplicaciones de servicio.</span><span class="sxs-lookup"><span data-stu-id="7a701-106">WCF loads common endpoint behaviors only for client applications and loads common service behaviors only for service applications.</span></span> <span data-ttu-id="7a701-107">Para instalar el mismo validador para las aplicaciones servicio, el validador debe ser un comportamiento de servicio.</span><span class="sxs-lookup"><span data-stu-id="7a701-107">To install this same validator for service applications, the validator must be a service behavior.</span></span> <span data-ttu-id="7a701-108">Para obtener más información, consulte el [ \<commonBehaviors >](../../../../docs/framework/configure-apps/file-schema/wcf/commonbehaviors.md) sección.</span><span class="sxs-lookup"><span data-stu-id="7a701-108">For more information, see the [\<commonBehaviors>](../../../../docs/framework/configure-apps/file-schema/wcf/commonbehaviors.md) section.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="7a701-109">Comportamientos de servicio o punto de conexión no están marcados con el <xref:System.Security.AllowPartiallyTrustedCallersAttribute> atributo (APTCA) que se agregan a la [ \<commonBehaviors >](../../../../docs/framework/configure-apps/file-schema/wcf/commonbehaviors.md) sección de un archivo de configuración no se ejecutan cuando la aplicación se ejecuta en una relación de confianza parcial entorno y ninguna excepción se produce cuando ocurre esto.</span><span class="sxs-lookup"><span data-stu-id="7a701-109">Service or endpoint behaviors not marked with the <xref:System.Security.AllowPartiallyTrustedCallersAttribute> attribute (APTCA) that are added to the [\<commonBehaviors>](../../../../docs/framework/configure-apps/file-schema/wcf/commonbehaviors.md) section of a configuration file are not run when the application runs in a partial trust environment, and no exception is thrown when this occurs.</span></span> <span data-ttu-id="7a701-110">Para forzar la ejecución de los comportamientos habituales, como los validadores, es necesario:</span><span class="sxs-lookup"><span data-stu-id="7a701-110">To enforce the running of common behaviors such as validators, you must either:</span></span>  
>   
>  <span data-ttu-id="7a701-111">-- Marcar el comportamiento habitual con el atributo <xref:System.Security.AllowPartiallyTrustedCallersAttribute> de modo que pueda ejecutarse cuando se implementa como una aplicación de confianza parcial.</span><span class="sxs-lookup"><span data-stu-id="7a701-111">-- Mark your common behavior with the <xref:System.Security.AllowPartiallyTrustedCallersAttribute> attribute so that it can run when deployed as a Partial Trust application.</span></span> <span data-ttu-id="7a701-112">Tenga en cuenta que puede establecerse una entrada de registro en el equipo para evitar que se ejecuten los ensamblados marcados con APTCA.</span><span class="sxs-lookup"><span data-stu-id="7a701-112">Note that a registry entry can be set on the computer to prevent APTCA-marked assemblies from running..</span></span>  
>   
>  <span data-ttu-id="7a701-113">-- Asegurarse de implementar la aplicación como una aplicación de confianza total en la que los usuarios no pueden modificar los valores de la seguridad de acceso del código para ejecutar la aplicación en un entorno de confianza parcial.</span><span class="sxs-lookup"><span data-stu-id="7a701-113">-- Ensure that if the application is deployed as a fully-trusted application that users cannot modify the code-access security settings to run the application in a Partial Trust environment.</span></span> <span data-ttu-id="7a701-114">De poder hacerlo, el validador personalizado no se ejecutaría y no se iniciaría ninguna excepción.</span><span class="sxs-lookup"><span data-stu-id="7a701-114">If they can do so, the custom validator does not run and no exception is thrown.</span></span> <span data-ttu-id="7a701-115">Para que una forma de asegurarse de esto, consulte el `levelfinal` mediante la opción [Code Access Security Policy Tool (Caspol.exe)](https://go.microsoft.com/fwlink/?LinkId=248222).</span><span class="sxs-lookup"><span data-stu-id="7a701-115">For one way to ensure this, see the `levelfinal` option using [Code Access Security Policy Tool (Caspol.exe)](https://go.microsoft.com/fwlink/?LinkId=248222).</span></span>  
>   
>  <span data-ttu-id="7a701-116">Para obtener más información, consulte [Partial Trust Best Practices](../../../../docs/framework/wcf/feature-details/partial-trust-best-practices.md) y [admite escenarios de implementación](../../../../docs/framework/wcf/feature-details/supported-deployment-scenarios.md).</span><span class="sxs-lookup"><span data-stu-id="7a701-116">For more information, see [Partial Trust Best Practices](../../../../docs/framework/wcf/feature-details/partial-trust-best-practices.md) and [Supported Deployment Scenarios](../../../../docs/framework/wcf/feature-details/supported-deployment-scenarios.md).</span></span>  
  
### <a name="to-create-the-endpoint-validator"></a><span data-ttu-id="7a701-117">Para crear el validador de punto de conexión</span><span class="sxs-lookup"><span data-stu-id="7a701-117">To create the endpoint validator</span></span>  
  
1. <span data-ttu-id="7a701-118">Cree un <xref:System.ServiceModel.Description.IEndpointBehavior> con los pasos de validación que desee en el método <xref:System.ServiceModel.Description.IEndpointBehavior.Validate%2A>.</span><span class="sxs-lookup"><span data-stu-id="7a701-118">Create an <xref:System.ServiceModel.Description.IEndpointBehavior> with the desired validation steps in the <xref:System.ServiceModel.Description.IEndpointBehavior.Validate%2A> method.</span></span> <span data-ttu-id="7a701-119">El siguiente código proporciona un ejemplo.</span><span class="sxs-lookup"><span data-stu-id="7a701-119">The following code provides an example.</span></span> <span data-ttu-id="7a701-120">(El `InternetClientValidatorBehavior` procede de la [validación de seguridad](../../../../docs/framework/wcf/samples/security-validation.md) ejemplo.)</span><span class="sxs-lookup"><span data-stu-id="7a701-120">(The `InternetClientValidatorBehavior` is taken from the [Security Validation](../../../../docs/framework/wcf/samples/security-validation.md) sample.)</span></span>  
  
     [!code-csharp[LockdownValidation#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/lockdownvalidation/cs/internetclientvalidatorbehavior.cs#2)]  
  
2. <span data-ttu-id="7a701-121">Cree un nuevo <xref:System.ServiceModel.Configuration.BehaviorExtensionElement> que registre el validador de punto de conexión creado en el paso 1.</span><span class="sxs-lookup"><span data-stu-id="7a701-121">Create new <xref:System.ServiceModel.Configuration.BehaviorExtensionElement> that registers the endpoint validator created in step 1.</span></span> <span data-ttu-id="7a701-122">El ejemplo de código siguiente muestra cómo hacerlo.</span><span class="sxs-lookup"><span data-stu-id="7a701-122">The following code example shows this.</span></span> <span data-ttu-id="7a701-123">(El código original para este ejemplo está en el [validación de seguridad](../../../../docs/framework/wcf/samples/security-validation.md) ejemplo.)</span><span class="sxs-lookup"><span data-stu-id="7a701-123">(The original code for this example is in the [Security Validation](../../../../docs/framework/wcf/samples/security-validation.md) sample.)</span></span>  
  
     [!code-csharp[LockdownValidation#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/lockdownvalidation/cs/internetclientvalidatorelement.cs#3)]  
  
3. <span data-ttu-id="7a701-124">Asegúrese de que el ensamblado compilado se firma con un nombre seguro.</span><span class="sxs-lookup"><span data-stu-id="7a701-124">Make sure the compiled assembly is signed with a strong name.</span></span> <span data-ttu-id="7a701-125">Para obtener más información, consulte el [Strong Name Tool (SN. (EXE)](https://go.microsoft.com/fwlink/?LinkId=248217) y los comandos del compilador para su idioma.</span><span class="sxs-lookup"><span data-stu-id="7a701-125">For details, see the [Strong Name Tool (SN.EXE)](https://go.microsoft.com/fwlink/?LinkId=248217) and the compiler commands for your language.</span></span>  
  
### <a name="to-install-the-validator-into-the-target-computer"></a><span data-ttu-id="7a701-126">Para instalar el validador en el equipo de destino</span><span class="sxs-lookup"><span data-stu-id="7a701-126">To install the validator into the target computer</span></span>  
  
1. <span data-ttu-id="7a701-127">Instale el validador del punto de conexión mediante el mecanismo adecuado.</span><span class="sxs-lookup"><span data-stu-id="7a701-127">Install the endpoint validator using the appropriate mechanism.</span></span> <span data-ttu-id="7a701-128">En una empresa, esto puede hacerse utilizando la directiva de grupo y Systems Management Server (SMS).</span><span class="sxs-lookup"><span data-stu-id="7a701-128">In an enterprise, this can be using Group Policy and Systems Management Server (SMS).</span></span>  
  
2. <span data-ttu-id="7a701-129">Instalar el ensamblado con nombre seguro en la caché global de ensamblados mediante la [Gacutil.exe (Global Assembly Cache Tool)](../../../../docs/framework/tools/gacutil-exe-gac-tool.md).</span><span class="sxs-lookup"><span data-stu-id="7a701-129">Install the strongly-named assembly into the global assembly cache using the [Gacutil.exe (Global Assembly Cache Tool)](../../../../docs/framework/tools/gacutil-exe-gac-tool.md).</span></span>  
  
3. <span data-ttu-id="7a701-130">Utilice los tipos de espacio de nombres de <xref:System.Configuration?displayProperty=nameWithType> para:</span><span class="sxs-lookup"><span data-stu-id="7a701-130">Use the <xref:System.Configuration?displayProperty=nameWithType> namespace types to:</span></span>  
  
    1. <span data-ttu-id="7a701-131">Agregue la extensión a la [ \<behaviorExtensions >](../../../../docs/framework/configure-apps/file-schema/wcf/behaviorextensions.md) sección con un nombre de tipo completo y bloquee el elemento.</span><span class="sxs-lookup"><span data-stu-id="7a701-131">Add the extension to the [\<behaviorExtensions>](../../../../docs/framework/configure-apps/file-schema/wcf/behaviorextensions.md) section using a fully-qualified type name and lock the element.</span></span>  
  
         [!code-csharp[LockdownValidation#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/lockdownvalidation/cs/hostapplication.cs#5)]  
  
    2. <span data-ttu-id="7a701-132">Agregue el elemento de comportamiento a la `EndpointBehaviors` propiedad de la [ \<commonBehaviors >](../../../../docs/framework/configure-apps/file-schema/wcf/commonbehaviors.md) sección y bloquee el elemento.</span><span class="sxs-lookup"><span data-stu-id="7a701-132">Add the behavior element to the `EndpointBehaviors` property of the [\<commonBehaviors>](../../../../docs/framework/configure-apps/file-schema/wcf/commonbehaviors.md) section and lock the element.</span></span> <span data-ttu-id="7a701-133">(Para instalar el validador en el servicio, el validador debe ser un <xref:System.ServiceModel.Description.IServiceBehavior> que se agregue a la propiedad `ServiceBehaviors`.) El ejemplo de código siguiente se muestra la configuración adecuada después de los pasos a.</span><span class="sxs-lookup"><span data-stu-id="7a701-133">(To install the validator on the service, the validator must be an <xref:System.ServiceModel.Description.IServiceBehavior> and added to the `ServiceBehaviors` property.) The following code example shows the proper configuration after steps a.</span></span> <span data-ttu-id="7a701-134">y b., con la única excepción de que no hay ningún nombre seguro.</span><span class="sxs-lookup"><span data-stu-id="7a701-134">and b., with the sole exception that there is no strong name.</span></span>  
  
         [!code-csharp[LockdownValidation#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/lockdownvalidation/cs/hostapplication.cs#6)]  
  
    3. <span data-ttu-id="7a701-135">Guarde el archivo machine.config.</span><span class="sxs-lookup"><span data-stu-id="7a701-135">Save the machine.config file.</span></span> <span data-ttu-id="7a701-136">El ejemplo de código siguiente realiza todas las tareas en el paso 3 pero guarda localmente una copia del archivo machine.config modificado.</span><span class="sxs-lookup"><span data-stu-id="7a701-136">The following code example performs all the tasks in step 3 but saves a copy of the modified machine.config file locally.</span></span>  
  
         [!code-csharp[LockdownValidation#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/lockdownvalidation/cs/hostapplication.cs#7)]  
  
## <a name="example"></a><span data-ttu-id="7a701-137">Ejemplo</span><span class="sxs-lookup"><span data-stu-id="7a701-137">Example</span></span>  
 <span data-ttu-id="7a701-138">El ejemplo de código siguiente muestra cómo agregar un comportamiento común al archivo machine.config y guardar una copia en el disco.</span><span class="sxs-lookup"><span data-stu-id="7a701-138">The following code example shows how to add a common behavior to the machine.config file and save a copy to the disk.</span></span> <span data-ttu-id="7a701-139">El `InternetClientValidatorBehavior` procede de la [validación de seguridad](../../../../docs/framework/wcf/samples/security-validation.md) ejemplo.</span><span class="sxs-lookup"><span data-stu-id="7a701-139">The `InternetClientValidatorBehavior` is taken from the [Security Validation](../../../../docs/framework/wcf/samples/security-validation.md) sample.</span></span>  
  
 [!code-csharp[LockdownValidation#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/lockdownvalidation/cs/hostapplication.cs#1)]  
  
## <a name="net-framework-security"></a><span data-ttu-id="7a701-140">Seguridad de .NET Framework</span><span class="sxs-lookup"><span data-stu-id="7a701-140">.NET Framework Security</span></span>  
 <span data-ttu-id="7a701-141">También puede querer cifrar los elementos del archivo de configuración.</span><span class="sxs-lookup"><span data-stu-id="7a701-141">You may also want to encrypt the configuration file elements.</span></span> <span data-ttu-id="7a701-142">Para obtener más información, vea la sección Vea también.</span><span class="sxs-lookup"><span data-stu-id="7a701-142">For more information, see the See Also section.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="7a701-143">Vea también</span><span class="sxs-lookup"><span data-stu-id="7a701-143">See also</span></span>

- [<span data-ttu-id="7a701-144">Cifrar los elementos del archivo de configuración mediante DPAPI</span><span class="sxs-lookup"><span data-stu-id="7a701-144">Encrypting configuration file elements using DPAPI</span></span>](https://go.microsoft.com/fwlink/?LinkId=94954)
- [<span data-ttu-id="7a701-145">Cifrar los elementos de archivo de configuración con RSA</span><span class="sxs-lookup"><span data-stu-id="7a701-145">Encrypting configuration file elements using RSA</span></span>](https://go.microsoft.com/fwlink/?LinkId=94955)
