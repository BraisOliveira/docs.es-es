---
title: Federación y confianza
ms.date: 03/30/2017
helpviewer_keywords:
- federation [WCF], and trust
ms.assetid: 4bdec4f2-f8a2-4512-bdcf-14ef54b5877a
ms.openlocfilehash: 4e1529db6cc52b6b8cc8881d2b2a35a754b4b311
ms.sourcegitcommit: 0be8a279af6d8a43e03141e349d3efd5d35f8767
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 04/18/2019
ms.locfileid: "59225344"
---
# <a name="federation-and-trust"></a><span data-ttu-id="0c206-102">Federación y confianza</span><span class="sxs-lookup"><span data-stu-id="0c206-102">Federation and Trust</span></span>
<span data-ttu-id="0c206-103">En este tema se trata diversos aspectos relacionados con las aplicaciones federadas, los límites de confianza y configuración y uso de tokens emitidos en Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="0c206-103">This topic covers various aspects related to federated applications, trust boundaries and configuration, and use of issued tokens in Windows Communication Foundation (WCF).</span></span>  
  
## <a name="services-security-token-services-and-trust"></a><span data-ttu-id="0c206-104">Servicios, servicios de tokens de seguridad y confianza</span><span class="sxs-lookup"><span data-stu-id="0c206-104">Services, Security Token Services, and Trust</span></span>  
 <span data-ttu-id="0c206-105">Los servicios que exponen puntos de conexión federados esperan por lo general que los clientes se autentiquen utilizando un token proporcionado por un emisor concreto.</span><span class="sxs-lookup"><span data-stu-id="0c206-105">Services that expose federated endpoints typically expect clients to authenticate using a token provided by a specific issuer.</span></span> <span data-ttu-id="0c206-106">Es importante que el servicio se configure con las credenciales correctas del emisor; de lo contrario, no podrá comprobar las signaturas sobre los tokens emitidos y el cliente no podrá comunicarse con el servicio.</span><span class="sxs-lookup"><span data-stu-id="0c206-106">It is important that the service is configured with the correct credentials for the issuer; otherwise, it will not be able to verify signatures over the issued tokens, and the client will be unable to communicate with the service.</span></span> <span data-ttu-id="0c206-107">Para obtener más información sobre cómo configurar las credenciales del emisor en el servicio, vea [Cómo: Configurar las credenciales en un servicio de federación](../../../../docs/framework/wcf/feature-details/how-to-configure-credentials-on-a-federation-service.md).</span><span class="sxs-lookup"><span data-stu-id="0c206-107">For more information about configuring issuer credentials on the service, see [How to: Configure Credentials on a Federation Service](../../../../docs/framework/wcf/feature-details/how-to-configure-credentials-on-a-federation-service.md).</span></span>  
  
 <span data-ttu-id="0c206-108">De manera similar, al utilizar las claves simétricas, las claves se cifran para el servicio de destino, por lo que debe configurar el servicio de tokens de seguridad con las credenciales correctas para el servicio de destino; de lo contrario, no podrá cifrar la clave para el servicio de destino y, de nuevo, el cliente no podrá comunicarse con el servicio.</span><span class="sxs-lookup"><span data-stu-id="0c206-108">Similarly, when using symmetric keys, the keys are encrypted for the target service, so you must configure the security token service with the correct credentials for the target service; otherwise, it will be unable to encrypt the key for the target service, and again, the client will be unable to communicate with the service.</span></span>  
  
 <span data-ttu-id="0c206-109">Servicios WCF usan el valor de la <xref:System.ServiceModel.Channels.LocalServiceSecuritySettings.MaxClockSkew%2A> propiedad en el [SecurityBindingElement](../../../../docs/framework/wcf/diagnostics/wmi/securitybindingelement.md) para permitir el reloj desfase entre el cliente y el servicio.</span><span class="sxs-lookup"><span data-stu-id="0c206-109">WCF services use the value of the <xref:System.ServiceModel.Channels.LocalServiceSecuritySettings.MaxClockSkew%2A> property on the [SecurityBindingElement](../../../../docs/framework/wcf/diagnostics/wmi/securitybindingelement.md) to allow for clock skew between the client and service.</span></span> <span data-ttu-id="0c206-110">En la federación, el valor `MaxClockSkew` se aplica a los desfases temporales entre el cliente y el servicio de tokens de seguridad de donde el cliente obtuvo el token emitido.</span><span class="sxs-lookup"><span data-stu-id="0c206-110">In federation, the `MaxClockSkew` setting applies to clock skews between both the client and the security token service from where the client obtained the issued token.</span></span> <span data-ttu-id="0c206-111">Por consiguiente, los servicios de tokens de seguridad no necesitan realizar concesiones de sesgo de reloj al establecer los tiempos de inicio y expiración del token emitido.</span><span class="sxs-lookup"><span data-stu-id="0c206-111">Therefore, security token services need not make clock-skew allowances when setting the issued token's effective and expiration times.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="0c206-112">La importancia de sesgo de reloj aumenta a medida que se reduce la vida del token emitido.</span><span class="sxs-lookup"><span data-stu-id="0c206-112">The importance of clock skew increases as the lifetime of the issued token shortens.</span></span> <span data-ttu-id="0c206-113">En la mayoría de los casos, el sesgo del reloj no es un problema significativo si la duración del token es de 30 minutos o más.</span><span class="sxs-lookup"><span data-stu-id="0c206-113">In most cases, clock skew is not a significant issue if the token lifetime is 30 minutes or more.</span></span> <span data-ttu-id="0c206-114">Los escenarios con duraciones más cortas o donde la hora de validez exacta del token es importante deberían estar diseñados para tener en cuenta el sesgo del reloj.</span><span class="sxs-lookup"><span data-stu-id="0c206-114">Scenarios with shorter lifetimes or where the exact validity time of the token is important should be designed to take clock skew into account.</span></span>  
  
## <a name="federated-endpoints-and-time-outs"></a><span data-ttu-id="0c206-115">Extremos federados y tiempos de espera</span><span class="sxs-lookup"><span data-stu-id="0c206-115">Federated Endpoints and Time-Outs</span></span>  
 <span data-ttu-id="0c206-116">Cuando un cliente se comunica con un punto de conexión federado, debe adquirir primero un token adecuado de un servicio de tokens de seguridad.</span><span class="sxs-lookup"><span data-stu-id="0c206-116">When a client communicates with a federated endpoint, it must first acquire an appropriate token from a security token service.</span></span> <span data-ttu-id="0c206-117">Si el servicio de tokens de seguridad expone un punto de conexión federado, el cliente debe obtener primero un token del emisor para ese punto de conexión.</span><span class="sxs-lookup"><span data-stu-id="0c206-117">If the security token service exposes a federated endpoint, the client must first obtain a token from the issuer for that endpoint.</span></span> <span data-ttu-id="0c206-118">Cada adquisición del token lleva tiempo y ese tiempo está sujeto al tiempo de espera total para enviar el mensaje real al extremo final.</span><span class="sxs-lookup"><span data-stu-id="0c206-118">Each token acquisition takes time, and that time is subject to the overall time-out for sending the actual message to the final endpoint.</span></span>  
  
 <span data-ttu-id="0c206-119">Por ejemplo, el tiempo de espera en el canal del lado de cliente está establecido en 30 segundos.</span><span class="sxs-lookup"><span data-stu-id="0c206-119">For example, the time-out on the client-side channel is set to 30 seconds.</span></span> <span data-ttu-id="0c206-120">Se ha de llamar a dos emisores de tokens para recuperar los tokens antes de enviar el mensaje al último punto de conexión y cada uno tarda 15 segundos en emitir un token.</span><span class="sxs-lookup"><span data-stu-id="0c206-120">Two token issuers need to be called to retrieve tokens before sending the message to the final endpoint, and each takes 15 seconds to issue a token.</span></span> <span data-ttu-id="0c206-121">En este caso, no se realizará el intento correctamente y se produce una <xref:System.TimeoutException>.</span><span class="sxs-lookup"><span data-stu-id="0c206-121">In this case, the attempt will fail and a <xref:System.TimeoutException> is thrown.</span></span> <span data-ttu-id="0c206-122">Por tanto, debe establecer el valor <xref:System.ServiceModel.IContextChannel.OperationTimeout%2A> en el canal de cliente en un valor lo suficientemente grande como para incluir el tiempo que se tarda en recuperar todos los tokens emitidos.</span><span class="sxs-lookup"><span data-stu-id="0c206-122">Thus, you need to set the <xref:System.ServiceModel.IContextChannel.OperationTimeout%2A> value on the client channel to a value large enough to include the time taken to retrieve all issued tokens.</span></span> <span data-ttu-id="0c206-123">En el caso en el que no se especifique un valor para la propiedad <xref:System.ServiceModel.IContextChannel.OperationTimeout%2A>, la propiedad <xref:System.ServiceModel.Channels.Binding.OpenTimeout%2A> o la propiedad (o ambas) <xref:System.ServiceModel.Channels.Binding.SendTimeout%2A> han de establecerse en un valor lo suficientemente grande como para incluir el tiempo invertido en recuperar todos los tokens emitidos.</span><span class="sxs-lookup"><span data-stu-id="0c206-123">In the case where a value is not specified for the <xref:System.ServiceModel.IContextChannel.OperationTimeout%2A> property, the <xref:System.ServiceModel.Channels.Binding.OpenTimeout%2A> property or the <xref:System.ServiceModel.Channels.Binding.SendTimeout%2A> property (or both) need to be set to a value large enough to include the time taken to retrieve all issued tokens.</span></span>  
  
## <a name="token-lifetime-and-renewal"></a><span data-ttu-id="0c206-124">Duración y renovación del token</span><span class="sxs-lookup"><span data-stu-id="0c206-124">Token Lifetime and Renewal</span></span>  
 <span data-ttu-id="0c206-125">Los clientes de WCF no comprueban el token emitido al realizar una solicitud inicial a un servicio.</span><span class="sxs-lookup"><span data-stu-id="0c206-125">WCF clients do not check the issued token when making an initial request to a service.</span></span>  <span data-ttu-id="0c206-126">En su lugar, WCF confía en el servicio de token de seguridad para emitir un token con tiempos de inicio y expiración adecuados.</span><span class="sxs-lookup"><span data-stu-id="0c206-126">Rather, WCF trusts the security token service to issue a token with appropriate effective and expiration times.</span></span> <span data-ttu-id="0c206-127">Si el cliente almacena el token en memoria caché y lo reutiliza, la duración del token se comprueba en las solicitudes subsiguientes y el cliente renueva automáticamente el token si fuese necesario.</span><span class="sxs-lookup"><span data-stu-id="0c206-127">If the token is cached by the client and reused, the token lifetime is checked on subsequent requests and the client automatically renews the token if necessary.</span></span> <span data-ttu-id="0c206-128">Para obtener más información sobre almacenamiento en caché de tokens, vea [Cómo: Crear un cliente federado](../../../../docs/framework/wcf/feature-details/how-to-create-a-federated-client.md).</span><span class="sxs-lookup"><span data-stu-id="0c206-128">For more information about token caching, see [How to: Create a Federated Client](../../../../docs/framework/wcf/feature-details/how-to-create-a-federated-client.md).</span></span>  
  
 <span data-ttu-id="0c206-129">Especificar una duración más corta, del orden de 30 segundos o menos para tokens emitidos o tokens de contexto de seguridad, puede dar lugar a tiempos de espera de negociación o de otras excepciones iniciadas por clientes de WCF al solicitar los tokens emitidos o al negociar o renovar la seguridad tokens de contexto.</span><span class="sxs-lookup"><span data-stu-id="0c206-129">Specifying short lifetimes, on the order of 30 seconds or less for issued tokens or security context tokens, may result in negotiation time-outs or other exceptions being thrown by WCF clients when requesting issued tokens or when negotiating or renewing security context tokens.</span></span>  
  
## <a name="issued-tokens-and-inclusionmode"></a><span data-ttu-id="0c206-130">Tokens emitidos e InclusionMode</span><span class="sxs-lookup"><span data-stu-id="0c206-130">Issued Tokens and InclusionMode</span></span>  
 <span data-ttu-id="0c206-131">Que un token emitido se serialice o no en un mensaje enviado desde un cliente hasta un extremo federado, se controla estableciendo la propiedad <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters.InclusionMode%2A> de la clase <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters>.</span><span class="sxs-lookup"><span data-stu-id="0c206-131">Whether an issued token is serialized in a message sent from a client to a federated endpoint or not is controlled by setting the <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters.InclusionMode%2A> property of the <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters> class.</span></span> <span data-ttu-id="0c206-132">Esta propiedad puede estar establecida en uno de los <xref:System.ServiceModel.Security.Tokens.SecurityTokenInclusionMode> valores de enumeración, pero no es útil en la mayoría de los escenarios federados.</span><span class="sxs-lookup"><span data-stu-id="0c206-132">This property can be set to one of the <xref:System.ServiceModel.Security.Tokens.SecurityTokenInclusionMode> enumeration values, but it is not useful in most federated scenarios.</span></span> <span data-ttu-id="0c206-133">Los valores `SecurityTokenInclusionMode.Never` y `SecurityTokenInclusionMode.AlwaysToInitiator` hacen que el cliente envíe una referencia al token emitido por el servicio de tokens de seguridad al usuario de confianza.</span><span class="sxs-lookup"><span data-stu-id="0c206-133">The `SecurityTokenInclusionMode.Never` and `SecurityTokenInclusionMode.AlwaysToInitiator` values cause the client to send a reference to the token issued by the security token service to the relying party.</span></span> <span data-ttu-id="0c206-134">A menos que el usuario de confianza posea una copia del token emitido, se producirá un error en la autenticación porque la referencia del token no se puede resolver.</span><span class="sxs-lookup"><span data-stu-id="0c206-134">Unless the relying party possesses a copy of the issued token, authentication will fail because the token reference is not resolvable.</span></span> <span data-ttu-id="0c206-135">WCF trata `SecurityTokenInclusionMode.Once` como equivalente a `SecurityTokenInclusionMode.AlwaysToRecipient`.</span><span class="sxs-lookup"><span data-stu-id="0c206-135">WCF treats `SecurityTokenInclusionMode.Once` as equivalent to `SecurityTokenInclusionMode.AlwaysToRecipient`.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="0c206-136">Vea también</span><span class="sxs-lookup"><span data-stu-id="0c206-136">See also</span></span>

- <xref:System.ServiceModel.Security.Tokens.SecurityTokenInclusionMode>
- [<span data-ttu-id="0c206-137">Cómo: Crear a un cliente federado</span><span class="sxs-lookup"><span data-stu-id="0c206-137">How to: Create a Federated Client</span></span>](../../../../docs/framework/wcf/feature-details/how-to-create-a-federated-client.md)
- [<span data-ttu-id="0c206-138">Cómo: Configurar las credenciales en un servicio de federación</span><span class="sxs-lookup"><span data-stu-id="0c206-138">How to: Configure Credentials on a Federation Service</span></span>](../../../../docs/framework/wcf/feature-details/how-to-configure-credentials-on-a-federation-service.md)
- [<span data-ttu-id="0c206-139">Cómo: Create a WSFederationHttpBinding</span><span class="sxs-lookup"><span data-stu-id="0c206-139">How to: Create a WSFederationHttpBinding</span></span>](../../../../docs/framework/wcf/feature-details/how-to-create-a-wsfederationhttpbinding.md)
