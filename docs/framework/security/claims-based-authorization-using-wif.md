---
title: Autorización basada en notificaciones con WIF
ms.date: 03/30/2017
ms.assetid: e24000a3-8fd8-4c0e-bdf0-39882cc0f6d8
author: BrucePerlerMS
ms.openlocfilehash: 9d20f8fbce916a038fc8224492a4077e1978ed8c
ms.sourcegitcommit: 9b1ac36b6c80176fd4e20eb5bfcbd9d56c3264cf
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 06/28/2019
ms.locfileid: "67422364"
---
# <a name="claims-based-authorization-using-wif"></a><span data-ttu-id="9b24c-102">Autorización basada en notificaciones con WIF</span><span class="sxs-lookup"><span data-stu-id="9b24c-102">Claims Based Authorization Using WIF</span></span>
<span data-ttu-id="9b24c-103">En una aplicación de usuario de confianza, la autorización determina los recursos a los que una identidad autenticada puede tener acceso y las operaciones que puede realizar en estos.</span><span class="sxs-lookup"><span data-stu-id="9b24c-103">In a relying party application, authorization determines what resources an authenticated identity is allowed to access and what operations it is allowed to perform on those resources.</span></span> <span data-ttu-id="9b24c-104">Una autorización incorrecta o débil da lugar a la revelación de información y a la alteración de los datos.</span><span class="sxs-lookup"><span data-stu-id="9b24c-104">Improper or weak authorization leads to information disclosure and data tampering.</span></span> <span data-ttu-id="9b24c-105">En este tema se describen distintos enfoques para implementar la autorización para aplicaciones web y servicios Web ASP.NET compatibles con notificaciones mediante Windows Identity Foundation (WIF) y un servicio de token de seguridad (STS), por ejemplo, el Servicio de control de acceso (ACS) de Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="9b24c-105">This topic outlines the available approaches to implementing authorization for claims-aware ASP.NET web applications and services using Windows Identity Foundation (WIF) and a Security Token Service (STS), for example, the Windows Azure Access Control Service (ACS).</span></span>  
  
## <a name="overview"></a><span data-ttu-id="9b24c-106">Información general</span><span class="sxs-lookup"><span data-stu-id="9b24c-106">Overview</span></span>  
 <span data-ttu-id="9b24c-107">Desde su primera versión, .NET Framework ha ofrecido un mecanismo flexible para implementar la autorización.</span><span class="sxs-lookup"><span data-stu-id="9b24c-107">Since its first version, the .NET Framework has offered a flexible mechanism for implementing authorization.</span></span> <span data-ttu-id="9b24c-108">Este mecanismo se basa en dos sencillas interfaces: **IPrincipal** e **IIdentity**.</span><span class="sxs-lookup"><span data-stu-id="9b24c-108">This mechanism is based on two simple interfaces—**IPrincipal** and **IIdentity**.</span></span> <span data-ttu-id="9b24c-109">Las implementaciones concretas de **IIdentity** representan a un usuario autenticado.</span><span class="sxs-lookup"><span data-stu-id="9b24c-109">Concrete implementations of **IIdentity** represent an authenticated user.</span></span> <span data-ttu-id="9b24c-110">Por ejemplo, la implementación de **WindowsIdentity** representa a un usuario autenticado por Active Directory y **GenericIdentity** representa a un usuario cuya identidad se comprueba mediante un proceso de autenticación personalizado.</span><span class="sxs-lookup"><span data-stu-id="9b24c-110">For example, the **WindowsIdentity** implementation represents a user who is authenticated by Active Directory, and **GenericIdentity** represents a user whose identity is verified via a custom authentication process.</span></span> <span data-ttu-id="9b24c-111">Las implementaciones concretas de **IPrincipal** ayudan a comprobar los permisos mediante roles según el almacén de roles.</span><span class="sxs-lookup"><span data-stu-id="9b24c-111">Concrete implementations of **IPrincipal** help to check permissions using roles depending on the role store.</span></span> <span data-ttu-id="9b24c-112">Por ejemplo, **WindowsPrincipal** comprueba la pertenencia a grupos de Active Directory de **WindowsIdentity**.</span><span class="sxs-lookup"><span data-stu-id="9b24c-112">For example, **WindowsPrincipal** checks **WindowsIdentity** for membership in Active Directory groups.</span></span> <span data-ttu-id="9b24c-113">Esta comprobación se realiza al llamar al método **IsInRole** en la interfaz **IPrincipal**.</span><span class="sxs-lookup"><span data-stu-id="9b24c-113">This check is performed by calling the **IsInRole** method on the **IPrincipal** interface.</span></span> <span data-ttu-id="9b24c-114">La comprobación del acceso basada en roles se denomina control de acceso basado en roles (RBAC).</span><span class="sxs-lookup"><span data-stu-id="9b24c-114">Checking access based on roles is called Role-Based Access Control (RBAC).</span></span> <span data-ttu-id="9b24c-115">Para más información, vea [Control de acceso basado en roles](../../../docs/framework/security/claims-based-authorization-using-wif.md#BKMK_1).</span><span class="sxs-lookup"><span data-stu-id="9b24c-115">For more information, see [Role-Based Access Control](../../../docs/framework/security/claims-based-authorization-using-wif.md#BKMK_1).</span></span>  <span data-ttu-id="9b24c-116">Las notificaciones se pueden usar para proporcionar información sobre roles a fin de admitir mecanismos de autorización basados en roles.</span><span class="sxs-lookup"><span data-stu-id="9b24c-116">Claims can be used to carry information about roles to support familiar, role-based authorization mechanisms.</span></span>  
  
 <span data-ttu-id="9b24c-117">Asimismo, pueden usarse para permitir decisiones de autorización más complicadas más allá de los roles.</span><span class="sxs-lookup"><span data-stu-id="9b24c-117">Claims can also be used to enable more complicated authorization decisions beyond roles.</span></span> <span data-ttu-id="9b24c-118">Las notificaciones pueden basarse en prácticamente cualquier información sobre el usuario: edad, código postal, talla de calzado, etc. Un mecanismo de control de acceso basado en notificaciones arbitrarias se denomina autorización basada en notificaciones.</span><span class="sxs-lookup"><span data-stu-id="9b24c-118">Claims can be based on virtually any information about the user - age, zip code, shoe size, etc. An access control mechanism that is based on arbitrary claims is called claims-based authorization.</span></span> <span data-ttu-id="9b24c-119">Para más información, vea [Autorización basada en notificaciones](../../../docs/framework/security/claims-based-authorization-using-wif.md#BKMK_2).</span><span class="sxs-lookup"><span data-stu-id="9b24c-119">For more information, see [Claims-based Authorization](../../../docs/framework/security/claims-based-authorization-using-wif.md#BKMK_2).</span></span>  
  
<a name="BKMK_1"></a>   
## <a name="role-based-access-control"></a><span data-ttu-id="9b24c-120">Control de acceso basado en roles</span><span class="sxs-lookup"><span data-stu-id="9b24c-120">Role-Based Access Control</span></span>  
 <span data-ttu-id="9b24c-121">El control de acceso basado en roles (RBAC) es un enfoque de autorización en el cual una aplicación basada en roles de usuario administra y aplica los permisos de usuario.</span><span class="sxs-lookup"><span data-stu-id="9b24c-121">RBAC is an authorization approach in which user permissions are managed and enforced by an application based on user roles.</span></span> <span data-ttu-id="9b24c-122">Si un usuario tiene un rol necesario para realizar una acción, se concede el acceso; de lo contrario, se deniega.</span><span class="sxs-lookup"><span data-stu-id="9b24c-122">If a user has a role that is required to perform an action, the access is granted; otherwise, access is denied.</span></span>  
  
### <a name="iprincipalisinrole-method"></a><span data-ttu-id="9b24c-123">Método IPrincipal.IsInRole</span><span class="sxs-lookup"><span data-stu-id="9b24c-123">IPrincipal.IsInRole Method</span></span>  
 <span data-ttu-id="9b24c-124">Para implementar el enfoque RBAC en aplicaciones para notificaciones, use el **IsInRole()** método en el **IPrincipal** interfaz, como haría en aplicaciones no compatibles con notificaciones.</span><span class="sxs-lookup"><span data-stu-id="9b24c-124">To implement the RBAC approach in claims-aware applications, use the **IsInRole()** method in the **IPrincipal** interface, just as you would in non-claims-aware applications.</span></span> <span data-ttu-id="9b24c-125">Existen varias formas de usar el método **IsInRole()** :</span><span class="sxs-lookup"><span data-stu-id="9b24c-125">There are several ways of using the **IsInRole()** method:</span></span>  
  
- <span data-ttu-id="9b24c-126">Al llamar explícitamente a **IPrincipal.IsInRole("Administrator")** .</span><span class="sxs-lookup"><span data-stu-id="9b24c-126">Explicitly calling on **IPrincipal.IsInRole("Administrator")**.</span></span> <span data-ttu-id="9b24c-127">En este enfoque, el resultado es un valor booleano.</span><span class="sxs-lookup"><span data-stu-id="9b24c-127">In this approach, the outcome is a Boolean.</span></span> <span data-ttu-id="9b24c-128">Úselo en las instrucciones condicionales.</span><span class="sxs-lookup"><span data-stu-id="9b24c-128">Use it in your conditional statements.</span></span> <span data-ttu-id="9b24c-129">Se puede usar arbitrariamente en cualquier parte del código.</span><span class="sxs-lookup"><span data-stu-id="9b24c-129">It can be used arbitrarily any place in your code.</span></span>  
  
- <span data-ttu-id="9b24c-130">Mediante la petición de seguridad **PrincipalPermission.Demand()** .</span><span class="sxs-lookup"><span data-stu-id="9b24c-130">Using the security demand **PrincipalPermission.Demand()**.</span></span> <span data-ttu-id="9b24c-131">En este enfoque, se produce una excepción en caso de que la petición no se cumpla.</span><span class="sxs-lookup"><span data-stu-id="9b24c-131">In this approach, the outcome is an exception in case the demand is not satisfied.</span></span> <span data-ttu-id="9b24c-132">Esta debe ajustarse a la estrategia de control de excepciones.</span><span class="sxs-lookup"><span data-stu-id="9b24c-132">This should fit your exception handling strategy.</span></span> <span data-ttu-id="9b24c-133">La generación de excepciones es mucho más costosa desde el punto de vista del rendimiento que la devolución del valor booleano.</span><span class="sxs-lookup"><span data-stu-id="9b24c-133">Throwing exceptions is much more expensive from a performance perspective compared to returning Boolean.</span></span> <span data-ttu-id="9b24c-134">Se puede usar en cualquier parte del código.</span><span class="sxs-lookup"><span data-stu-id="9b24c-134">This can be used any place in your code.</span></span>  
  
- <span data-ttu-id="9b24c-135">Al usar los atributos declarativos **[PrincipalPermission(SecurityAction.Demand, Role = "Administrator")]** .</span><span class="sxs-lookup"><span data-stu-id="9b24c-135">Using the declarative attributes **[PrincipalPermission(SecurityAction.Demand, Role = "Administrator")]**.</span></span> <span data-ttu-id="9b24c-136">Este enfoque se denomina declarativo porque se usa para representar métodos.</span><span class="sxs-lookup"><span data-stu-id="9b24c-136">This approach is called declarative, because it is used to decorate methods.</span></span> <span data-ttu-id="9b24c-137">No se puede usar en bloques de código dentro de implementaciones de método.</span><span class="sxs-lookup"><span data-stu-id="9b24c-137">It cannot be used in code blocks inside the method’s implementations.</span></span> <span data-ttu-id="9b24c-138">Se produce una excepción en caso de que no se cumpla la petición.</span><span class="sxs-lookup"><span data-stu-id="9b24c-138">The outcome is an exception in case the demand is not satisfied.</span></span> <span data-ttu-id="9b24c-139">Debe asegurarse de que se ajuste a la estrategia de control de excepciones.</span><span class="sxs-lookup"><span data-stu-id="9b24c-139">You should make sure that it fits your exception-handling strategy.</span></span>  
  
- <span data-ttu-id="9b24c-140">Al usar la autorización para URL, mediante la sección **\<authorization>** de **web.config**. Este enfoque resulta conveniente al administrar la autorización en un nivel de dirección URL.</span><span class="sxs-lookup"><span data-stu-id="9b24c-140">Using URL authorization, using the **\<authorization>** section in **web.config**. This approach is suitable when you are managing authorization on a URL level.</span></span> <span data-ttu-id="9b24c-141">Es el nivel más amplio de todos los mencionados anteriormente.</span><span class="sxs-lookup"><span data-stu-id="9b24c-141">This is the most coarse level among those previously mentioned.</span></span> <span data-ttu-id="9b24c-142">La ventaja de este enfoque es que los cambios se realizan en el archivo de configuración, lo que significa que el código no debe compilarse para beneficiarse del cambio.</span><span class="sxs-lookup"><span data-stu-id="9b24c-142">The advantage of this approach is that changes are made in the configuration file, which means that the code should not be compiled to take advantage of the change.</span></span>  
  
### <a name="expressing-roles-as-claims"></a><span data-ttu-id="9b24c-143">Expresar roles como notificaciones</span><span class="sxs-lookup"><span data-stu-id="9b24c-143">Expressing Roles as Claims</span></span>  
 <span data-ttu-id="9b24c-144">Cuando se llama al método **IsInRole()** , se comprueba si el usuario actual tiene ese rol.</span><span class="sxs-lookup"><span data-stu-id="9b24c-144">When the **IsInRole()** method is called, there is a check made to see if the current user has that role.</span></span> <span data-ttu-id="9b24c-145">En las aplicaciones para notificaciones, el rol se expresa mediante un tipo de notificación de rol que debe estar disponible en el token.</span><span class="sxs-lookup"><span data-stu-id="9b24c-145">In claims-aware applications, the role is expressed by a role claim type that should be available in the token.</span></span> <span data-ttu-id="9b24c-146">El tipo de notificación de rol se expresa mediante el URI siguiente:</span><span class="sxs-lookup"><span data-stu-id="9b24c-146">The role claim type is expressed using the following URI:</span></span>  
  
 `http://schemas.microsoft.com/ws/2008/06/identity/claims/role`
  
 <span data-ttu-id="9b24c-147">Hay varias formas de enriquecer un token con un tipo de notificación de rol:</span><span class="sxs-lookup"><span data-stu-id="9b24c-147">There are several ways to enrich a token with a role claim type:</span></span>  
  
- <span data-ttu-id="9b24c-148">**Durante la emisión de tokens**.</span><span class="sxs-lookup"><span data-stu-id="9b24c-148">**During token issuance**.</span></span> <span data-ttu-id="9b24c-149">Cuando se autentica un usuario, tanto el STS del proveedor de identidad como un proveedor de federación, por ejemplo, Microsoft Azure Access Control Service (ACS), pueden emitir la notificación de rol.</span><span class="sxs-lookup"><span data-stu-id="9b24c-149">When a user is authenticated the role claim can be issued by the identity provider STS or by a federation provider such as the Windows Azure Access Control Service (ACS).</span></span>  
  
- <span data-ttu-id="9b24c-150">**Al transformar notificaciones arbitrarias en notificaciones de tipo de rol mediante ClaimsAuthenticationManager**.</span><span class="sxs-lookup"><span data-stu-id="9b24c-150">**Transforming arbitrary claims into of claims role type using ClaimsAuthenticationManager**.</span></span> <span data-ttu-id="9b24c-151">ClaimsAuthenticationManager es un componente que se distribuye como parte de WIF.</span><span class="sxs-lookup"><span data-stu-id="9b24c-151">The ClaimsAuthenticationManager is a component that ships as part of WIF.</span></span> <span data-ttu-id="9b24c-152">Permite interceptar las solicitudes al iniciar una aplicación, inspeccionar tokens y transformarlos mediante la adición, cambio o eliminación de notificaciones.</span><span class="sxs-lookup"><span data-stu-id="9b24c-152">It allows requests to be intercepted when they launch an application, inspecting tokens and transforming them by adding, changing, or removing claims.</span></span> <span data-ttu-id="9b24c-153">Para obtener más información acerca de cómo usar ClaimsAuthenticationManager para transformar notificaciones, consulte [How To: Control de acceso (RBAC) basado en el rol de implementar en una aplicación de ASP.NET compatible con notificaciones mediante WIF y ACS](https://go.microsoft.com/fwlink/?LinkID=247445).</span><span class="sxs-lookup"><span data-stu-id="9b24c-153">For more information about how to use ClaimsAuthenticationManager for transforming claims, see [How To: Implement Role Based Access Control (RBAC) in a Claims Aware ASP.NET Application Using WIF and ACS](https://go.microsoft.com/fwlink/?LinkID=247445).</span></span>  
  
- <span data-ttu-id="9b24c-154">**Al asignar notificaciones arbitrarias a un tipo de rol mediante la sección de configuración samlSecurityTokenRequirement**: enfoque declarativo donde la transformación de las notificaciones se lleva a cabo únicamente a través de la configuración sin necesidad de codificación.</span><span class="sxs-lookup"><span data-stu-id="9b24c-154">**Mapping arbitrary claims to a role type using the samlSecurityTokenRequirement configuration section**—A declarative approach where the claims transformation is done using only the configuration and no coding is required.</span></span>  
  
<a name="BKMK_2"></a>   
## <a name="claims-based-authorization"></a><span data-ttu-id="9b24c-155">Autorización basada en notificaciones</span><span class="sxs-lookup"><span data-stu-id="9b24c-155">Claims-based Authorization</span></span>  
 <span data-ttu-id="9b24c-156">La autorización basada en notificaciones es un enfoque donde la decisión sobre la autorización para conceder o denegar el acceso se basa en lógica arbitraria que usa los datos disponibles en las notificaciones para tomar la decisión.</span><span class="sxs-lookup"><span data-stu-id="9b24c-156">Claims-based authorization is an approach where the authorization decision to grant or deny access is based on arbitrary logic that uses data available in claims to make the decision.</span></span> <span data-ttu-id="9b24c-157">Recuerde que, en el caso del RBAC, la única notificación que se usaba era la de tipo de rol</span><span class="sxs-lookup"><span data-stu-id="9b24c-157">Recall that in the case of RBAC, the only claim used was role type claim.</span></span> <span data-ttu-id="9b24c-158">para comprobar si el usuario pertenecía o no a un rol concreto.</span><span class="sxs-lookup"><span data-stu-id="9b24c-158">A role type claim was used to check if the user belongs to specific role or not.</span></span> <span data-ttu-id="9b24c-159">Para ilustrar el proceso de toma de decisiones de autorización mediante un enfoque basado en notificaciones, tenga en cuenta los pasos siguientes:</span><span class="sxs-lookup"><span data-stu-id="9b24c-159">To illustrate the process of making the authorization decisions using claims-based authorization approach, consider the following steps:</span></span>  
  
1. <span data-ttu-id="9b24c-160">La aplicación recibe una solicitud que requiere la autenticación del usuario.</span><span class="sxs-lookup"><span data-stu-id="9b24c-160">The application receives a request that requires the user is authenticated.</span></span>  
  
2. <span data-ttu-id="9b24c-161">WIF redirige al usuario al proveedor de identidad correspondiente. Una vez autenticado, la solicitud de la aplicación se realiza con un token de seguridad asociado que representa al usuario y contiene notificaciones sobre este.</span><span class="sxs-lookup"><span data-stu-id="9b24c-161">WIF redirects the user to their identity provider, after they are authenticated the application request is made with an associated security token representing the user containing claims about them.</span></span> <span data-ttu-id="9b24c-162">WIF asocia dichas notificaciones a la entidad de seguridad que representa al usuario.</span><span class="sxs-lookup"><span data-stu-id="9b24c-162">WIF associates those claims with the principal that represents the user.</span></span>  
  
3. <span data-ttu-id="9b24c-163">La aplicación pasa las notificaciones al mecanismo de lógica de decisión.</span><span class="sxs-lookup"><span data-stu-id="9b24c-163">The application passes the claims to the decision logic mechanism.</span></span> <span data-ttu-id="9b24c-164">Puede ser código en memoria, una llamada a un servicio Web, una consulta a una base de datos, un motor de reglas sofisticado o mediante ClaimsAuthorizationManager.</span><span class="sxs-lookup"><span data-stu-id="9b24c-164">It can be in-memory code, a call to a web service, a query to a database, a sophisticated rules engine, or using the ClaimsAuthorizationManager.</span></span>  
  
4. <span data-ttu-id="9b24c-165">El mecanismo de decisión calcula el resultado en función de las notificaciones.</span><span class="sxs-lookup"><span data-stu-id="9b24c-165">The decision mechanism calculates the outcome based on the claims.</span></span>  
  
5. <span data-ttu-id="9b24c-166">El acceso se concede si el resultado es true y se deniega si es false.</span><span class="sxs-lookup"><span data-stu-id="9b24c-166">Access is granted if the outcome is true and denied if it is false.</span></span> <span data-ttu-id="9b24c-167">Por ejemplo, la regla podría ser que el usuario tenga 21 años o más y resida en el estado de Washington.</span><span class="sxs-lookup"><span data-stu-id="9b24c-167">For example, the rule might be that the user is of age 21 or above and lives in Washington State.</span></span>  
  
 <span data-ttu-id="9b24c-168"><xref:System.Security.Claims.ClaimsAuthorizationManager> es útil para exteriorizar la lógica de decisión de la autorización basada en notificaciones de las aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="9b24c-168"><xref:System.Security.Claims.ClaimsAuthorizationManager> is useful for externalizing the decision logic for  claims-based authorization in your applications.</span></span> <span data-ttu-id="9b24c-169">ClaimsAuthorizationManager es un componente de WIF que se distribuye como parte de .NET 4.5.</span><span class="sxs-lookup"><span data-stu-id="9b24c-169">ClaimsAuthorizationManager is a WIF component that ships as part of .NET 4.5.</span></span> <span data-ttu-id="9b24c-170">ClaimsAuthorizationManager permite interceptar solicitudes entrantes e implementar la lógica deseada para tomar decisiones de autorización en función de las notificaciones entrantes.</span><span class="sxs-lookup"><span data-stu-id="9b24c-170">ClaimsAuthorizationManager allows you to intercept incoming requests and implement any logic of your choice to make authorization decisions based on the incoming claims.</span></span> <span data-ttu-id="9b24c-171">Esto es importante cuando es necesario cambiar la lógica de autorización.</span><span class="sxs-lookup"><span data-stu-id="9b24c-171">This becomes important when authorization logic needs to be changed.</span></span> <span data-ttu-id="9b24c-172">En ese caso, el uso de ClaimsAuthorizationManager no afectará a la integridad de la aplicación y se reducirá la probabilidad de un error de aplicación como resultado del cambio.</span><span class="sxs-lookup"><span data-stu-id="9b24c-172">In that case, using ClaimsAuthorizationManager will not affect the application’s integrity, thereby reducing the likelihood of an application error as a result of the change.</span></span> <span data-ttu-id="9b24c-173">Para obtener más información sobre cómo usar ClaimsAuthorizationManager para implementar el control de acceso basado en notificaciones, consulte [How To: Implementar notificaciones de autorización en una aplicación de ASP.NET compatible con notificaciones mediante WIF y ACS](https://go.microsoft.com/fwlink/?LinkID=247446).</span><span class="sxs-lookup"><span data-stu-id="9b24c-173">To learn more about how to use ClaimsAuthorizationManager to implement claims-based access control, see [How To: Implement Claims Authorization in a Claims Aware ASP.NET Application Using WIF and ACS](https://go.microsoft.com/fwlink/?LinkID=247446).</span></span>
