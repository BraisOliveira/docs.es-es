---
title: Crear servicios resistentes listos para la nube. aceptación de errores transitorios en la nube
description: Modernizar aplicaciones .NET existentes con contenedores de Windows y la nube de Azure | Crear servicios resistentes listos para la nube. aceptación de errores transitorios en la nube
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 04/30/2018
ms.openlocfilehash: 801d017457d1cdc3c8a495c8127b203380cb1d9e
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 04/23/2019
ms.locfileid: "61811844"
---
# <a name="build-resilient-services-ready-for-the-cloud-embrace-transient-failures-in-the-cloud"></a><span data-ttu-id="27d52-105">Creación de servicios resistentes y aptos para la nube: aceptación de errores transitorios en la nube</span><span class="sxs-lookup"><span data-stu-id="27d52-105">Build resilient services ready for the cloud: Embrace transient failures in the cloud</span></span>

<span data-ttu-id="27d52-106">La resistencia es la capacidad de recuperarse de errores y seguir funcionando.</span><span class="sxs-lookup"><span data-stu-id="27d52-106">Resiliency is the ability to recover from failures and continue to function.</span></span> <span data-ttu-id="27d52-107">La resistencia no es sobre cómo evitar los errores, pero acepta el hecho de que se producirán errores y, a continuación, responder a ellas de forma que evite la pérdida de datos o el tiempo de inactividad.</span><span class="sxs-lookup"><span data-stu-id="27d52-107">Resiliency is not about avoiding failures, but accepting the fact that failures will occur, and then responding to them in a way that avoids downtime or data loss.</span></span> <span data-ttu-id="27d52-108">El objetivo de la resistencia consiste en que la aplicación vuelva a un estado totalmente operativo después de un error.</span><span class="sxs-lookup"><span data-stu-id="27d52-108">The goal of resiliency is to return the application to a fully functioning state after a failure.</span></span>

<span data-ttu-id="27d52-109">La aplicación está lista para la nube cuando, como mínimo, implementa un modelo basado en software de resistencia, en lugar de un modelo basado en hardware.</span><span class="sxs-lookup"><span data-stu-id="27d52-109">Your application is ready for the cloud when, at a minimum, it implements a software-based model of resiliency, rather than a hardware-based model.</span></span> <span data-ttu-id="27d52-110">La aplicación en la nube debe adoptar los errores parciales que seguramente se.</span><span class="sxs-lookup"><span data-stu-id="27d52-110">Your cloud application must embrace the partial failures that will certainly occur.</span></span> <span data-ttu-id="27d52-111">Diseñar o parcialmente refactorizar la aplicación para lograr resistencia esperado errores parciales.</span><span class="sxs-lookup"><span data-stu-id="27d52-111">Design or partially refactor your application to achieve resiliency with expected partial failures.</span></span> <span data-ttu-id="27d52-112">Se deben diseñarse para hacer frente a errores parciales, como las interrupciones de red transitorios y nodos o máquinas virtuales que se bloquea en la nube.</span><span class="sxs-lookup"><span data-stu-id="27d52-112">It should be designed to cope with partial failures, like transient network outages and nodes, or VMs crashing in the cloud.</span></span> <span data-ttu-id="27d52-113">Incluso los contenedores que se mueven a otro nodo dentro de un clúster de orquestador pueden causar breves errores intermitentes dentro de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="27d52-113">Even containers being moved to a different node within an orchestrator cluster can cause intermittent short failures within the application.</span></span>

## <a name="handling-partial-failure"></a><span data-ttu-id="27d52-114">Controlar errores parciales</span><span class="sxs-lookup"><span data-stu-id="27d52-114">Handling partial failure</span></span>

<span data-ttu-id="27d52-115">En una aplicación basada en la nube, hay un riesgo siempre presente de error parcial.</span><span class="sxs-lookup"><span data-stu-id="27d52-115">In a cloud-based application, there's an ever-present risk of partial failure.</span></span> <span data-ttu-id="27d52-116">Por ejemplo, podría producir un error en una instancia de un sitio Web único o un contenedor, o podría ser no está disponible o no responde durante un breve período.</span><span class="sxs-lookup"><span data-stu-id="27d52-116">For instance, a single website instance or a container might fail, or it might be unavailable or unresponsive for a short time.</span></span> <span data-ttu-id="27d52-117">O bien, un único servidor o máquina virtual puede bloquearse.</span><span class="sxs-lookup"><span data-stu-id="27d52-117">Or, a single VM or server might crash.</span></span>

<span data-ttu-id="27d52-118">Dado que los clientes y servicios son procesos independientes, un servicio no pueda responder de manera oportuna a petición de un cliente.</span><span class="sxs-lookup"><span data-stu-id="27d52-118">Because clients and services are separate processes, a service might not be able to respond in a timely manner to a client's request.</span></span> <span data-ttu-id="27d52-119">El servicio podría estar sobrecargado y respuesta lenta a las solicitudes, o podría no ser accesible durante un breve tiempo debido a problemas de red.</span><span class="sxs-lookup"><span data-stu-id="27d52-119">The service might be overloaded and respond slowly to requests, or it might not be accessible for a short time because of network issues.</span></span>

<span data-ttu-id="27d52-120">Por ejemplo, considere la posibilidad de una aplicación monolítica de .NET que tiene acceso a una base de datos en Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="27d52-120">For example, consider a monolithic .NET application that accesses a database in Azure SQL Database.</span></span> <span data-ttu-id="27d52-121">Si la base de datos SQL de Azure o cualquier otro servicio de terceros no responde para una breve tiempo (Azure SQL database se puede mover a un nodo diferente o un servidor y dejar de responder durante unos segundos), cuando el usuario intenta llevar a cabo cualquier acción, la aplicación puede bloquearse y mostrar w una excepción en el mismo momento.</span><span class="sxs-lookup"><span data-stu-id="27d52-121">If the Azure SQL database or any other third-party service is unresponsive for a brief time (an Azure SQL database might be moved to a different node or server, and be unresponsive for a few seconds), when the user tries to do any action, the application might crash and show an exception at the same moment.</span></span>

<span data-ttu-id="27d52-122">Una situación similar puede producirse en una aplicación que consume los servicios HTTP.</span><span class="sxs-lookup"><span data-stu-id="27d52-122">A similar scenario might occur in an app that consumes HTTP services.</span></span> <span data-ttu-id="27d52-123">La red o el propio servicio no esté disponible en la nube durante un error transitorio, corto.</span><span class="sxs-lookup"><span data-stu-id="27d52-123">The network or the service itself might not be available in the cloud during a short, transient failure.</span></span>

<span data-ttu-id="27d52-124">Una aplicación resistente como el que se muestra en la figura 4-9 debe implementar técnicas, como "reintentos con retroceso exponencial" para dar una oportunidad para controlar errores transitorios en los recursos de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="27d52-124">A resilient application like the one shown in Figure 4-9 should implement techniques like "retries with exponential backoff" to give the application an opportunity to handle transient failures in resources.</span></span> <span data-ttu-id="27d52-125">También debe usar "disyuntores" en sus aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="27d52-125">You also should use "circuit breakers" in your applications.</span></span> <span data-ttu-id="27d52-126">Un disyuntor se detiene una aplicación intente tener acceso a un recurso cuando es realmente un error de larga duración.</span><span class="sxs-lookup"><span data-stu-id="27d52-126">A circuit breaker stops an application from trying to access a resource when it's actually a long-term failure.</span></span> <span data-ttu-id="27d52-127">Mediante el uso de un disyuntor, la aplicación evita que invitan reflexión una denegación de servicio a sí mismo.</span><span class="sxs-lookup"><span data-stu-id="27d52-127">By using a circuit breaker, the application avoids provoking a denial of service to itself.</span></span>

![Errores parciales controladas los reintentos con retroceso exponencial](./media/image9.png)

> <span data-ttu-id="27d52-129">**Figura 4-9.**</span><span class="sxs-lookup"><span data-stu-id="27d52-129">**Figure 4-9.**</span></span> <span data-ttu-id="27d52-130">Errores parciales controladas los reintentos con retroceso exponencial</span><span class="sxs-lookup"><span data-stu-id="27d52-130">Partial failures handled by retries with exponential backoff</span></span>

<span data-ttu-id="27d52-131">Puede utilizar estas técnicas en los recursos HTTP y en los recursos de base de datos.</span><span class="sxs-lookup"><span data-stu-id="27d52-131">You can use these techniques both in HTTP resources and in database resources.</span></span> <span data-ttu-id="27d52-132">En la figura 4-9, la aplicación se basa en una arquitectura de 3 niveles, por lo que necesita estas técnicas en el nivel de servicios (HTTP) y en el nivel de datos (TCP).</span><span class="sxs-lookup"><span data-stu-id="27d52-132">In Figure 4-9, the application is based on a 3-tier architecture, so you need these techniques at the services level (HTTP) and at the data tier level (TCP).</span></span> <span data-ttu-id="27d52-133">En una aplicación monolítica que se usa sólo un nivel de aplicación único además de la base de datos (sin servicios adicionales ni microservicios), control de errores transitorios en el nivel de conexión de base de datos podría ser suficiente.</span><span class="sxs-lookup"><span data-stu-id="27d52-133">In a monolithic application that uses only a single app tier in addition to the database (no additional services or microservices), handling transient failures at the database connection level might be enough.</span></span> <span data-ttu-id="27d52-134">En ese caso, se requiere solo una configuración específica de la conexión de base de datos.</span><span class="sxs-lookup"><span data-stu-id="27d52-134">In that scenario, just a particular configuration of the database connection is required.</span></span>

<span data-ttu-id="27d52-135">Al implementar communications resistente que tienen acceso a la base de datos, según la versión de .NET que usa, puede ser sencillo (por ejemplo, [con Entity Framework 6 o posterior](/ef/ef6/fundamentals/connection-resiliency/retry-logic).</span><span class="sxs-lookup"><span data-stu-id="27d52-135">When implementing resilient communications that access the database, depending on the version of .NET you are using, it can be straightforward (for example, [with Entity Framework 6 or later](/ef/ef6/fundamentals/connection-resiliency/retry-logic).</span></span> <span data-ttu-id="27d52-136">(Es simplemente una cuestión de configurar la conexión de base de datos).</span><span class="sxs-lookup"><span data-stu-id="27d52-136">It's just a matter of configuring the database connection).</span></span> <span data-ttu-id="27d52-137">O bien, es posible que deba utilizar bibliotecas adicionales, como el [Transient Fault Handling Application Block](https://docs.microsoft.com/previous-versions/msp-n-p/hh680934(v=pandp.50)) (para versiones anteriores de. NET), o incluso implementar su propia biblioteca.</span><span class="sxs-lookup"><span data-stu-id="27d52-137">Or, you might need to use additional libraries like the [Transient Fault Handling Application Block](https://docs.microsoft.com/previous-versions/msp-n-p/hh680934(v=pandp.50)) (for earlier versions of .NET), or even implement your own library.</span></span>

<span data-ttu-id="27d52-138">Al implementar los reintentos de HTTP y los disyuntores, la recomendación para .NET es usar el [Polly](https://github.com/App-vNext/Polly) biblioteca, que tiene como destino .NET Framework 4.0, .NET Framework 4.5 y .NET Standard 1.1, que incluye compatibilidad con .NET Core.</span><span class="sxs-lookup"><span data-stu-id="27d52-138">When implementing HTTP retries and circuit breakers, the recommendation for .NET is to use the [Polly](https://github.com/App-vNext/Polly) library, which targets .NET Framework 4.0, .NET Framework 4.5, and .NET Standard 1.1, which includes .NET Core support.</span></span>

<span data-ttu-id="27d52-139">Para obtener información sobre cómo implementar estrategias para tratar errores parciales en la nube, consulte las siguientes referencias.</span><span class="sxs-lookup"><span data-stu-id="27d52-139">To learn how to implement strategies for handling partial failures in the cloud, see the following references.</span></span>

### <a name="additional-resources"></a><span data-ttu-id="27d52-140">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="27d52-140">Additional resources</span></span>

- <span data-ttu-id="27d52-141">**Implementación de la comunicación resistente para controlar errores parciales**</span><span class="sxs-lookup"><span data-stu-id="27d52-141">**Implementing resilient communication to handle partial failure**</span></span>

    [https://docs.microsoft.com/dotnet/standard/microservices-architecture/implement-resilient-applications/partial-failure-strategies](../../microservices-architecture/implement-resilient-applications/partial-failure-strategies.md)

- <span data-ttu-id="27d52-142">**Entity Framework reintento y resistencia lógica de conexión (versión 6 y versiones posterior)**</span><span class="sxs-lookup"><span data-stu-id="27d52-142">**Entity Framework connection resiliency and retry logic (version 6 and later)**</span></span>

    [https://docs.microsoft.com/ef/ef6/fundamentals/connection-resiliency/retry-logic](/ef/ef6/fundamentals/connection-resiliency/retry-logic)

- <span data-ttu-id="27d52-143">**El bloque de aplicaciones de control de errores transitorios**</span><span class="sxs-lookup"><span data-stu-id="27d52-143">**The Transient Fault Handling Application Block**</span></span>

- <https://docs.microsoft.com/previous-versions/msp-n-p/hh680934(v=pandp.50)>

- <span data-ttu-id="27d52-144">**Biblioteca de Polly para la comunicación HTTP resistente**</span><span class="sxs-lookup"><span data-stu-id="27d52-144">**Polly library for resilient HTTP communication**</span></span>

    https://github.com/App-vNext/Polly

>[!div class="step-by-step"]
><span data-ttu-id="27d52-145">[Anterior](when-to-deploy-windows-containers-to-azure-container-service-kubernetes.md)
>[Siguiente](modernize-your-apps-with-monitoring-and-telemetry.md)</span><span class="sxs-lookup"><span data-stu-id="27d52-145">[Previous](when-to-deploy-windows-containers-to-azure-container-service-kubernetes.md)
[Next](modernize-your-apps-with-monitoring-and-telemetry.md)</span></span>
